/* Tiny tinycomments plugin
*
* Copyright 2010-2018 Tiny Technologies Inc. All rights reserved.
*
* Version: 2.0.1-76
*/
!function(b){"use strict";var y=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]},v=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,n))}},W=function(n){return function(){return n}},s=function(n){return n};function l(r){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.concat(n);return r.apply(null,t)}}var n,e,t,r,o,w,i,u=function(n){return function(){throw new Error(n)}},c=W(!1),a=W(!0),O=W("dismiss.popups"),f=c,d=a,m=function(){return g},g=(r={fold:function(n,e){return n()},is:f,isSome:f,isNone:d,getOr:t=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:e,map:m,ap:m,each:function(){},bind:m,flatten:m,exists:f,forall:d,filter:m,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:W("none()")},Object.freeze&&Object.freeze(r),r),p=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:d,isNone:f,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return p(n(t))},ap:function(n){return n.fold(m,function(n){return p(n(t))})},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:g},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(f,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},A={some:p,none:m,from:function(n){return null==n?g:p(n)}},h=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:W(n)}},_={fromHtml:function(n,e){var t=(e||b.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw b.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return h(t.childNodes[0])},fromTag:function(n,e){var t=(e||b.document).createElement(n);return h(t)},fromText:function(n,e){var t=(e||b.document).createTextNode(n);return h(t)},fromDom:h,fromPoint:function(n,e,t){var r=n.dom();return A.from(r.elementFromPoint(e,t)).map(h)}},x=function(m,g){return function(n){if(m(n)){var e,t,r,o,i,u,c,a=_.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},l=v(f,s),d=(e=a,t=n.clientX,r=n.clientY,o=s,i=f,u=l,c=n,{target:W(e),x:W(t),y:W(r),stop:o,prevent:i,kill:u,raw:W(c)});g(d)}}},S=function(n,e,t,r,o){var i=x(t,r);return n.dom().addEventListener(e,i,o),{unbind:l(E,n,e,i,o)}},E=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},k=W(!0),C=function(n,e,t){return S(n,e,k,t,!1)},T=function(n,e,t){return S(n,e,k,t,!0)},D=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(n)===e}},M=D("string"),N=D("object"),F=D("array"),B=D("boolean"),H=D("function"),R=D("number"),I=void 0===(o=Array.prototype.indexOf)?function(n,e){return K(n,e)}:function(n,e){return o.call(n,e)},P=function(n,e){return-1<I(n,e)},V=function(n,e){return Y(n,e).isSome()},j=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},L=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t,n)},U=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},z=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t,n)}(n,function(n){t=e(t,n)}),t},G=function(n,e,t){return L(n,function(n){t=e(t,n)}),t},q=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return A.some(o)}return A.none()},Y=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t,n))return A.some(t);return A.none()},K=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},X=Array.prototype.push,Q=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);X.apply(e,n[t])}return e},$=function(n,e){var t=j(n,e);return Q(t)},J=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t,n))return!1;return!0},Z=Array.prototype.slice,nn=function(n){var e=Z.call(n,0);return e.reverse(),e},en=function(n,e){return U(n,function(n){return!P(e,n)})},tn=function(n){return 0===n.length?A.none():A.some(n[0])},rn=(H(Array.from)&&Array.from,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var r={};return L(e,function(n,e){r[n]=W(t[e])}),r}}),on=Object.keys,un=Object.hasOwnProperty,cn=function(n,e){for(var t=on(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},an=function(n,r){return sn(n,function(n,e,t){return{k:e,v:r(n,e,t)}})},sn=function(r,o){var i={};return cn(r,function(n,e){var t=o(n,e,r);i[t.k]=t.v}),i},fn=function(n,t){var r=[];return cn(n,function(n,e){r.push(t(n,e))}),r},ln=function(n,e){return un.call(n,e)},dn=function(n){return n.slice(0).sort()},mn=function(e,n){if(!F(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");L(n,function(n){if(!M(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})},gn=function(o,i){var t,u=o.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return mn("required",o),mn("optional",i),t=dn(u),q(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}),function(e){var t=on(e);J(o,function(n){return P(t,n)})||function(n,e){throw new Error("All required keys ("+dn(n).join(", ")+") were not specified. Specified keys were: "+dn(e).join(", ")+".")}(o,t);var n=U(t,function(n){return!P(u,n)});0<n.length&&function(n){throw new Error("Unsupported keys for object: "+dn(n).join(", "))}(n);var r={};return L(o,function(n){r[n]=W(e[n])}),L(i,function(n){r[n]=W(Object.prototype.hasOwnProperty.call(e,n)?A.some(e[n]):A.none())}),r}},vn=void 0!==b.window?b.window:Function("return this;")(),pn=function(n,e){return function(n,e){for(var t=null!=e?e:vn,r=0;r<n.length&&null!=t;++r)t=t[n[r]];return t}(n.split("."),e)},hn=function(n,e){var t=pn(n,e);if(null==t)throw n+" not available on this browser";return t},bn=function(t){var r,o=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o||(o=!0,r=t.apply(null,n)),r}},yn=function(){return wn(0,0)},wn=function(n,e){return{major:n,minor:e}},On={nu:wn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?yn():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return wn(r(1),r(2))}(n,t)},unknown:yn},_n="Firefox",xn=function(n,e){return function(){return e===n}},Sn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:xn("Edge",e),isChrome:xn("Chrome",e),isIE:xn("IE",e),isOpera:xn("Opera",e),isFirefox:xn(_n,e),isSafari:xn("Safari",e)}},En={unknown:function(){return Sn({current:void 0,version:On.unknown()})},nu:Sn,edge:W("Edge"),chrome:W("Chrome"),ie:W("IE"),opera:W("Opera"),firefox:W(_n),safari:W("Safari")},kn="Windows",Cn="Android",Tn="Solaris",Dn="FreeBSD",Mn=function(n,e){return function(){return e===n}},Nn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Mn(kn,e),isiOS:Mn("iOS",e),isAndroid:Mn(Cn,e),isOSX:Mn("OSX",e),isLinux:Mn("Linux",e),isSolaris:Mn(Tn,e),isFreeBSD:Mn(Dn,e)}},An={unknown:function(){return Nn({current:void 0,version:On.unknown()})},nu:Nn,windows:W(kn),ios:W("iOS"),android:W(Cn),linux:W("Linux"),osx:W("OSX"),solaris:W(Tn),freebsd:W(Dn)},Fn=function(n,e){var t=String(e).toLowerCase();return q(n,function(n){return n.search(t)})},Bn=function(n,t){return Fn(n,t).map(function(n){var e=On.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Hn=function(n,t){return Fn(n,t).map(function(n){var e=On.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Rn=function(n,e){return-1!==n.indexOf(e)},In=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Pn=function(e){return function(n){return Rn(n,e)}},Vn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Rn(n,"edge/")&&Rn(n,"chrome")&&Rn(n,"safari")&&Rn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,In],search:function(n){return Rn(n,"chrome")&&!Rn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Rn(n,"msie")||Rn(n,"trident")}},{name:"Opera",versionRegexes:[In,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Pn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Pn("firefox")},{name:"Safari",versionRegexes:[In,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Rn(n,"safari")||Rn(n,"mobile/"))&&Rn(n,"applewebkit")}}],jn=[{name:"Windows",search:Pn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Rn(n,"iphone")||Rn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Pn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Pn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Pn("linux"),versionRegexes:[]},{name:"Solaris",search:Pn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Pn("freebsd"),versionRegexes:[]}],Ln={browsers:W(Vn),oses:W(jn)},Un=function(n){var e,t,r,o,i,u,c,a,s,f,l,d=Ln.browsers(),m=Ln.oses(),g=Bn(d,n).fold(En.unknown,En.nu),v=Hn(m,n).fold(An.unknown,An.nu);return{browser:g,os:v,deviceType:(t=g,r=n,o=(e=v).isiOS()&&!0===/ipad/i.test(r),i=e.isiOS()&&!o,u=e.isAndroid()&&3===e.version.major,c=e.isAndroid()&&4===e.version.major,a=o||u||c&&!0===/mobile/i.test(r),s=e.isiOS()||e.isAndroid(),f=s&&!a,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:W(o),isiPhone:W(i),isTablet:W(a),isPhone:W(f),isTouch:W(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:W(l)})}},Wn={detect:bn(function(){var n=b.navigator.userAgent;return Un(n)})},zn=(b.Node.ATTRIBUTE_NODE,b.Node.CDATA_SECTION_NODE,b.Node.COMMENT_NODE,b.Node.DOCUMENT_NODE),Gn=(b.Node.DOCUMENT_TYPE_NODE,b.Node.DOCUMENT_FRAGMENT_NODE,b.Node.ELEMENT_NODE),qn=b.Node.TEXT_NODE,Yn=(b.Node.PROCESSING_INSTRUCTION_NODE,b.Node.ENTITY_REFERENCE_NODE,b.Node.ENTITY_NODE,b.Node.NOTATION_NODE,Gn),Kn=zn,Xn=function(n,e){var t=n.dom();if(t.nodeType!==Yn)return!1;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},Qn=function(n){return n.nodeType!==Yn&&n.nodeType!==Kn||0===n.childElementCount},$n=function(n,e){return n.dom()===e.dom()},Jn=(Wn.detect().browser.isIE(),function(n){return _.fromDom(n.dom().ownerDocument)}),Zn=function(n){var e=n.dom().ownerDocument.defaultView;return _.fromDom(e)},ne=function(n){var e=n.dom();return A.from(e.parentNode).map(_.fromDom)},ee=function(n){var e=n.dom();return j(e.childNodes,_.fromDom)},te=function(n,e){var t=n.dom().childNodes;return A.from(t[e]).map(_.fromDom)},re=function(n){return te(n,0)},oe=(rn("element","offset"),function(e,t){ne(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),ie=function(e,t){re(e).fold(function(){ue(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},ue=function(n,e){n.dom().appendChild(e.dom())},ce=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return ce(t())}}},ae=function(n){var t=A.none(),e=[],r=function(n){o()?u(n):e.push(n)},o=function(){return t.isSome()},i=function(n){L(n,u)},u=function(e){t.each(function(n){b.setTimeout(function(){e(n)},0)})};return n(function(n){t=A.some(n),i(e),e=[]}),{get:r,map:function(t){return ae(function(e){r(function(n){e(t(n))})})},isReady:o}},se={nu:ae,pure:function(e){return ae(function(n){n(e)})}},fe=function(e){var n=function(n){var r;e((r=n,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this;b.setTimeout(function(){r.apply(t,n)},0)}))},t=function(){return se.nu(n)};return{map:function(r){return fe(function(t){n(function(n){var e=r(n);t(e)})})},bind:function(t){return fe(function(e){n(function(n){t(n).get(e)})})},anonBind:function(t){return fe(function(e){n(function(n){t.get(e)})})},toLazy:t,toCached:function(){var e=null;return fe(function(n){null===e&&(e=t()),e.get(n)})},get:n}},le={nu:fe,pure:function(e){return fe(function(n){n(e)})}},de=function(n){return n.dom().nodeName.toLowerCase()},me=function(e){return function(n){return n.dom().nodeType===e}},ge=me(Gn),ve=me(qn),pe=me(zn),he=function(n,e,t){if(!(M(t)||B(t)||R(t)))throw b.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},be=function(n,e,t){he(n.dom(),e,t)},ye=function(n,e){var t=n.dom();cn(e,function(n,e){he(t,e,n)})},we=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},Oe=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},_e=function(n,e){n.dom().removeAttribute(e)},xe=function(n){var e=ve(n)?n.dom().parentNode:n.dom();return null!=e&&e.ownerDocument.body.contains(e)},Se=(bn(function(){return Se(_.fromDom(b.document))}),function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return _.fromDom(e)}),Ee=(ce(A.none()),"_tinycomments_sidebar"),ke=function(n){(0,tinymce[Ee])(n)};(i=w||(w={}))[i.Modern=0]="Modern",i[i.Silver=1]="Silver";var Ce=function(){return(Ce=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function Te(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&(t[r[o]]=n[r[o]])}return t}var De,Me,Ne=function(t){return{is:function(n){return t===n},isValue:a,isError:c,getOr:W(t),getOrThunk:W(t),getOrDie:W(t),or:function(n){return Ne(t)},orThunk:function(n){return Ne(t)},fold:function(n,e){return e(t)},map:function(n){return Ne(n(t))},mapError:function(n){return Ne(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return A.some(t)}}},Ae=function(t){return{is:c,isValue:c,isError:a,getOr:s,getOrThunk:function(n){return n()},getOrDie:function(){return u(String(t))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return Ae(t)},mapError:function(n){return Ae(n(t))},each:y,bind:function(n){return Ae(t)},exists:c,forall:a,toOption:A.none}},Fe={value:Ne,error:Ae},Be=function(i){return Ce({},i,{toCached:function(){return Be(i.toCached())},bindFuture:function(e){return Be(i.bind(function(n){return n.fold(function(n){return le.pure(Fe.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Be(i.map(function(n){return n.bind(e)}))},mapResult:function(e){return Be(i.map(function(n){return n.map(e)}))},mapError:function(e){return Be(i.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return i.map(function(n){return n.fold(e,t)})},withTimeout:function(n,o){return Be(le.nu(function(e){var t=!1,r=b.setTimeout(function(){t=!0,e(Fe.error(o()))},n);i.get(function(n){t||(b.clearTimeout(r),e(n))})}))}})},He=function(n){return Be(le.nu(n))},Re=function(n){return Be(le.pure(Fe.value(n)))},Ie={nu:He,wrap:Be,pure:Re,value:Re,error:function(n){return Be(le.pure(Fe.error(n)))},fromResult:function(n){return Be(le.pure(n))},fromFuture:function(n){return Be(n.map(Fe.value))},fromPromise:function(n){return He(function(e){n.then(function(n){e(Fe.value(n))},function(n){e(Fe.error(n))})})}},Pe=function(n,e){var t=we(n,e);return void 0===t||""===t?[]:t.split(" ")},Ve=function(n){return void 0!==n.dom().classList},je=function(n,e){return o=e,i=Pe(t=n,r="class").concat([o]),be(t,r,i.join(" ")),!0;var t,r,o,i},Le=function(n,e){return o=e,0<(i=U(Pe(t=n,r="class"),function(n){return n!==o})).length?be(t,r,i.join(" ")):_e(t,r),!1;var t,r,o,i},Ue=function(n,e){Ve(n)?n.dom().classList.add(e):je(n,e)},We=function(n){0===(Ve(n)?n.dom().classList:Pe(n,"class")).length&&_e(n,"class")},ze=function(n,e){Ve(n)?n.dom().classList.remove(e):Le(n,e),We(n)},Ge=function(n,e){return Ve(n)&&n.dom().classList.contains(e)},qe=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),Qn(o)?[]:j(o.querySelectorAll(t),_.fromDom);var t,r,o},Ye=W("tox-comment--active"),Ke=(W("data-mce-annotation-uid"),W("data-mce-annotation"),W("tinycomments"));function Xe(e,u,o,c){var t=function(n,e){o.notificationManager.open({text:n,type:"error"}),e&&console.error(n,e)},r=function(n,e){return{view:{type:"splash"},grabFocus:function(){return 1===n||e}}},i=function(n,i){u.set(n),u.get().fold(function(){return Ie.pure({response:De.Change,update:r(i,c.hasFocus())})},function(n){return e.lookup({conversationUid:n}).foldResult(function(n){return Fe.value({response:De.Change,update:r(i,c.hasFocus())})},function(e){var n,t,r,o=u.get().forall(function(n){return n!==e.conversation.uid});return Fe.value(o?{response:De.NoChange}:{response:De.Change,update:(n=i,t=c.hasFocus(),r=e.conversation,{view:{type:"comments",conversation:r},grabFocus:function(){return t||P([1,3,4],n)}})})})}).get(function(n){return n.fold(function(n){t("An error occurred reading the conversation. See the Console for details.",n)},function(n){n.response===De.Change&&c.update(n.update)})})},a=function(n){var e="."+Ye(),t=_.fromDom(n.getBody()),r=qe(t,e);L(r,function(n){ze(n,Ye())})};return{refreshSidebar:i,refreshView:function(n){n.fold(function(){a(o),i(A.none(),0)},function(n){var e,t=n.uid,r=n.nodes;e=r,a(o),L(e,function(n){Ue(n,Ye())}),i(A.some(t),0)})},showError:t}}(Me=De||(De={}))[Me.Change=0]="Change",Me[Me.NoChange=1]="NoChange";var Qe,$e,Je=function(u){if(!F(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var c=[],t={};return L(u,function(n,r){var e=on(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=n[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!F(i))throw new Error("case arguments must be an array");c.push(o),t[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(n){var e=on(n);if(c.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+c.join(",")+"\nActual: "+e.join(","));if(!J(c,function(n){return P(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+c.join(", "));return n[o].apply(null,t)},log:function(n){b.console.log(n,{constructors:c,constructor:o,params:t})}}}}),t},Ze=Object.prototype.hasOwnProperty,nt=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o=n[r];for(var i in o)Ze.call(o,i)&&(t[i]=u(t[i],o[i]))}return t}},et=nt(function(n,e){return N(n)&&N(e)?et(n,e):e}),tt=nt(function(n,e){return e}),rt=Je([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ot=function(n){return rt.defaultedThunk(W(n))},it=rt.strict,ut=rt.asOption,ct=rt.defaultedThunk,at=rt.mergeWithThunk,st=function(e){return function(n){return ln(n,e)?A.from(n[e]):A.none()}},ft=function(n,e){return st(e)(n)},lt=function(n,e){var t={};return t[n]=e,t},dt=(Je([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){return st(n)}),mt=function(n,e){return t=n,r=e,function(n){return ln(n,t)?n[t]:r};var t,r},gt=function(n,e){return ft(n,e)},vt=function(n,e){return lt(n,e)},pt=function(n){return e={},L(n,function(n){e[n.key]=n.value}),e;var e},ht=function(n,e){var t,r,o,i,u,c=(t=[],r=[],L(n,function(n){n.fold(function(n){t.push(n)},function(n){r.push(n)})}),{errors:t,values:r});return 0<c.errors.length?(u=c.errors,v(Fe.error,Q)(u)):(i=e,0===(o=c.values).length?Fe.value(i):Fe.value(et(i,tt.apply(void 0,o))))},bt=function(n,e){return ln(t=n,r=e)&&void 0!==t[r]&&null!==t[r];var t,r};($e=Qe||(Qe={}))[$e.Error=0]="Error",$e[$e.Value=1]="Value";var yt,wt,Ot=function(n,e,t){return n.stype===Qe.Error?e(n.serror):t(n.svalue)},_t=function(n){return{stype:Qe.Value,svalue:n}},xt=function(n){return{stype:Qe.Error,serror:n}},St=function(n){return n.fold(xt,_t)},Et=function(n){return Ot(n,Fe.error,Fe.value)},kt=_t,Ct=function(n){var e=[],t=[];return L(n,function(n){Ot(n,function(n){return t.push(n)},function(n){return e.push(n)})}),{values:e,errors:t}},Tt=xt,Dt=function(n,e){return n.stype===Qe.Value?e(n.svalue):n},Mt=function(n,e){return n.stype===Qe.Error?e(n.serror):n},Nt=function(n,e){return n.stype===Qe.Value?{stype:Qe.Value,svalue:e(n.svalue)}:n},At=function(n,e){return n.stype===Qe.Error?{stype:Qe.Error,serror:e(n.serror)}:n},Ft=function(n){return v(Tt,Q)(n)},Bt=function(n,e){var t,r,o=Ct(n);return 0<o.errors.length?Ft(o.errors):(t=o.values,r=e,0<t.length?kt(et(r,tt.apply(void 0,t))):kt(r))},Ht=function(n){var e=Ct(n);return 0<e.errors.length?Ft(e.errors):kt(e.values)},Rt=Je([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),It=Je([{field:["name","presence","type"]},{state:["name"]}]),Pt=function(){return hn("JSON")},Vt=function(n,e,t){return Pt().stringify(n,e,t)},jt=function(n){return N(n)&&100<on(n).length?" removed due to size":Vt(n,null,2)},Lt=function(n,e){return Tt([{path:n,getErrorInfo:e}])},Ut=Je([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Wt=function(t,r,o){return ft(r,o).fold(function(){return n=o,e=r,Lt(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+jt(e)});var n,e},kt)},zt=function(n,e,t){var r=ft(n,e).fold(function(){return t(n)},s);return kt(r)},Gt=function(c,a,n,s){return n.fold(function(o,t,n,r){var i=function(n){var e=r.extract(c.concat([o]),s,n);return Nt(e,function(n){return lt(t,s(n))})},u=function(n){return n.fold(function(){var n=lt(t,s(A.none()));return kt(n)},function(n){var e=r.extract(c.concat([o]),s,n);return Nt(e,function(n){return lt(t,s(A.some(n)))})})};return n.fold(function(){return Dt(Wt(c,a,o),i)},function(n){return Dt(zt(a,o,n),i)},function(){return Dt(kt(ft(a,o)),u)},function(n){return Dt((t=n,r=ft(e=a,o).map(function(n){return!0===n?t(e):n}),kt(r)),u);var e,t,r},function(n){var e=n(a),t=Nt(zt(a,o,W({})),function(n){return et(e,n)});return Dt(t,i)})},function(n,e){var t=e(a);return kt(lt(n,s(t)))})},qt=function(r){return{extract:function(t,n,e){return Mt(r(e,n),function(n){return e=n,Lt(t,function(){return e});var e})},toString:function(){return"val"},toDsl:function(){return Rt.itemOf(r)}}},Yt=function(n){var a=Kt(n),s=z(n,function(e,n){return n.fold(function(n){return et(e,vt(n,!0))},W(e))},{});return{extract:function(n,e,t){var r,o,i,u=B(t)?[]:(o=on(r=t),U(o,function(n){return bt(r,n)})),c=U(u,function(n){return!bt(s,n)});return 0===c.length?a.extract(n,e,t):(i=c,Lt(n,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:a.toString,toDsl:a.toDsl}},Kt=function(c){return{extract:function(n,e,t){return r=n,o=t,i=e,u=j(c,function(n){return Gt(r,o,n,i)}),Bt(u,{});var r,o,i,u},toString:function(){return"obj{\n"+j(c,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return Rt.objOf(j(c,function(n){return n.fold(function(n,e,t,r){return It.field(n,t,r)},function(n,e){return It.state(n)})}))}}},Xt=function(t,i){var u=function(n,e){return(o=qt(t),{extract:function(t,r,n){var e=j(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return Ht(e)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return Rt.arrOf(o)}}).extract(n,s,e);var o};return{extract:function(t,r,o){var n=on(o),e=u(t,n);return Dt(e,function(n){var e=j(n,function(n){return Ut.field(n,n,it(),i)});return Kt(e).extract(t,r,o)})},toString:function(){return"setOf("+i.toString()+")"},toDsl:function(){return Rt.setOf(t,i)}}},Qt=W(qt(kt)),$t=Ut.state,Jt=Ut.field,Zt=function(t,e,r,o,i){return gt(o,i).fold(function(){return n=o,e=i,Lt(t,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+jt(n)});var n,e},function(n){return Kt(n).extract(t.concat(["branch: "+i]),e,r)})},nr=function(o,i){return{extract:function(e,t,r){return gt(r,o).fold(function(){return n=o,Lt(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return Zt(e,t,r,i,n)})},toString:function(){return"chooseOn("+o+"). Possible values: "+on(i)},toDsl:function(){return Rt.choiceOf(o,i)}}},er=qt(kt),tr=function(e){return qt(function(n){return e(n).fold(Tt,kt)})},rr=function(e,n){return Xt(function(n){return St(e(n))},n)},or=function(n,e,t){return Et((r=n,o=s,i=t,u=e.extract([r],o,i),At(u,function(n){return{input:i,errors:n}})));var r,o,i,u},ir=function(n){return n.fold(function(n){throw new Error(cr(n))},s)},ur=function(n,e,t){return ir(or(n,e,t))},cr=function(n){return"Errors: \n"+(e=n.errors,t=10<e.length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,j(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+jt(n.input);var e,t},ar=function(n,e){return nr(n,e)},sr=W(er),fr=(yt=H,wt="function",qt(function(n){var e=typeof n;return yt(n)?kt(n):Tt("Expected type: "+wt+" but got: "+e)})),lr=function(n){return Jt(n,n,it(),Qt())},dr=function(n,e){return Jt(n,n,it(),e)},mr=function(n,e){return Jt(n,n,it(),Kt(e))},gr=function(n){return Jt(n,n,ut(),Qt())},vr=function(n,e){return Jt(n,n,ut(),Kt(e))},pr=function(n,e){return Jt(n,n,ut(),Yt(e))},hr=function(n,e){return Jt(n,n,ot(e),Qt())},br=function(n,e,t){return Jt(n,n,ot(e),t)},yr=function(n,e){return $t(n,e)},wr={init:function(){return Or({readState:function(){return"No State required"}})}},Or=function(n){return n},_r=function(n,e){return $n(n.element(),e.event().target())},xr=function(n){if(!bt(n,"can")&&!bt(n,"abort")&&!bt(n,"run"))throw new Error("EventHandler defined by: "+Vt(n,null,2)+" does not have can, abort, or run!");return ur("Extracting event.handler",Yt([hr("can",W(!0)),hr("abort",W(!1)),hr("run",y)]),n)},Sr=function(t){var e,r,o,i,n=(e=t,r=function(n){return n.can},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return G(e,function(n,e){return n&&r(e).apply(void 0,t)},!0)}),u=(o=t,i=function(n){return n.abort},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return G(o,function(n,e){return n||i(e).apply(void 0,t)},!1)});return xr({can:n,abort:u,run:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];L(t,function(n){n.run.apply(void 0,e)})}})},Er=W("touchstart"),kr=W("touchmove"),Cr=W("touchend"),Tr=W("mousedown"),Dr=W("mouseover"),Mr=W("keydown"),Nr=W("keyup"),Ar=W("input"),Fr=W("click"),Br=W("transitionend"),Hr={tap:W("alloy.tap")},Rr=W("alloy.focus"),Ir=W("alloy.blur.post"),Pr=W("alloy.paste.post"),Vr=W("alloy.receive"),jr=W("alloy.execute"),Lr=W("alloy.focus.item"),Ur=Hr.tap,Wr=Wn.detect().deviceType.isTouch()?Hr.tap:Fr,zr=W("alloy.longpress"),Gr=W("alloy.sandbox.close"),qr=W("alloy.system.init"),Yr=W("alloy.system.attached"),Kr=W("alloy.system.detached"),Xr=W("alloy.system.dismissRequested"),Qr=W("alloy.focusmanager.shifted"),$r=W("alloy.highlight"),Jr=W("alloy.dehighlight"),Zr=function(n,e){ro(n,n.element(),e,{})},no=function(n,e,t){ro(n,n.element(),e,t)},eo=function(n){Zr(n,jr())},to=function(n,e,t){ro(n,e,t,{})},ro=function(n,e,t,r){var o=Ce({target:e},r);n.getSystem().triggerEvent(t,e,an(o,W))};function oo(n,e,t,r,o){return n(t,r)?A.some(t):H(o)&&o(t)?A.none():e(t,r,o)}var io,uo,co,ao=function(n,e,t){for(var r=n.dom(),o=H(t)?t:W(!1);r.parentNode;){r=r.parentNode;var i=_.fromDom(r);if(e(i))return A.some(i);if(o(i))break}return A.none()},so=function(n,e,t){return oo(function(n){return e(n)},ao,n,e,t)},fo=function(n,r){var o=function(n){for(var e=0;e<n.childNodes.length;e++){if(r(_.fromDom(n.childNodes[e])))return A.some(_.fromDom(n.childNodes[e]));var t=o(n.childNodes[e]);if(t.isSome())return t}return A.none()};return o(n.dom())},lo=function(n,e,t){return so(n,function(n){return e(n).isSome()},t).bind(e)},mo=function(n){return pt(n)},go=function(n,e){return{key:n,value:xr({run:e})}},vo=function(n){return function(t){return{key:n,value:xr({run:function(n,e){_r(n,e)&&t(n,e)}})}}},po=function(n){return go(n,function(n,e){e.cut()})},ho=vo(Yr()),bo=vo(Kr()),yo=vo(qr()),wo=(io=jr(),function(n){return go(io,n)}),Oo=function(n){return j(n,function(n){return r=e="/*",o=(t=n).length-e.length,""!==r&&(t.length<r.length||t.substr(o,o+r.length)!==r)?n:n.substring(0,n.length-"/*".length);var e,t,r,o})},_o=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:Oo(i)}},n},xo=function(n){return{classes:void 0!==n.classes?n.classes:[],attributes:void 0!==n.attributes?n.attributes:{},styles:void 0!==n.styles?n.styles:{}}},So=function(t,r,o){return yo(function(n,e){o(n,t,r)})},Eo=function(n,e,t,r,o,i){var u,c,a=n,s=vr(e,[(u="config",c=n,Jt(u,u,ut(),c))]);return To(a,s,e,t,r,o,i)},ko=function(o,i,u){var n,e,t,r,c,a;return n=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=[t].concat(n);return t.config({name:W(o)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+o+". Using API: "+u)},function(n){var e=Array.prototype.slice.call(r,1);return i.apply(void 0,[t,n.config,n.state].concat(e))})},e=u,t=i.toString(),r=t.indexOf(")")+1,c=t.indexOf("("),a=t.substring(c+1,r-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:e,parameters:Oo(a.slice(0,1).concat(a.slice(3)))}},n},Co=function(n){return{key:n,value:void 0}},To=function(t,n,r,o,e,i,u){var c=function(n){return bt(n,r)?n[r]():A.none()},a=an(e,function(n,e){return ko(r,n,e)}),s=an(i,function(n,e){return _o(n,e)}),f=Ce({},s,a,{revoke:l(Co,r),config:function(n){var e=ur(r+"-config",t,n);return{key:r,value:{config:e,me:f,configAsRaw:bn(function(){return ur(r+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return c(n).bind(function(e){return gt(o,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(xo({}))},name:function(){return r},handlers:function(n){return c(n).map(function(n){return mt("events",function(n,e){return{}})(o)(n.config,n.state)}).getOr({})}});return f},Do=function(n){return pt(n)},Mo=Yt([lr("fields"),lr("name"),hr("active",{}),hr("apis",{}),hr("state",wr),hr("extra",{})]),No=function(n){var e,t,r,o,i,u,c,a,s=ur("Creating behaviour: "+n.name,Mo,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,c=Yt(e),a=vr(t,[pr("config",e)]),To(c,a,t,r,o,i,u)},Ao=Yt([lr("branchKey"),lr("branches"),lr("name"),hr("active",{}),hr("apis",{}),hr("state",wr),hr("extra",{})]),Fo=W(void 0),Bo=function(n,e){var t,r;return{key:n,value:{config:{},me:(t=n,r=mo(e),No({fields:[lr("enabled")],name:t,active:{events:W(r)}})),configAsRaw:W({}),initialConfig:{},state:wr}}},Ho=function(n){n.dom().focus()},Ro=function(n){var e=void 0!==n?n.dom():b.document;return A.from(e.activeElement).map(_.fromDom)},Io=function(e){return Ro(Jn(e)).filter(function(n){return e.dom().contains(n.dom())})},Po=function(e,n){L(n,function(n){ue(e,n)})},Vo=function(n){n.dom().textContent="",L(ee(n),function(n){jo(n)})},jo=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Lo=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},Uo=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return A.none()},Wo=function(n){return n.dom().innerHTML},zo=function(n,e){var t,r,o=Jn(n).dom(),i=_.fromDom(o.createDocumentFragment()),u=(t=e,(r=(o||b.document).createElement("div")).innerHTML=t,ee(_.fromDom(r)));Po(i,u),Vo(n),ue(n,i)},Go=function(n){return e=n,t=!1,_.fromDom(e.dom().cloneNode(t));var e,t},qo=function(n){var e,t,r,o=Go(n);return e=o,t=_.fromTag("div"),r=_.fromDom(e.dom().cloneNode(!0)),ue(t,r),Wo(t)},Yo=function(n){return qo(n)},Ko="unknown";(co=uo||(uo={}))[co.STOP=0]="STOP",co[co.NORMAL=1]="NORMAL",co[co.LOGGING=2]="LOGGING";var Xo,Qo=ce({}),$o=function(e,n,t){var r,o,i,u;switch(gt(Qo.get(),e).orThunk(function(){var n=on(Qo.get());return Uo(n,function(n){return-1<e.indexOf(n)?A.some(Qo.get()[n]):A.none()})}).getOr(uo.NORMAL)){case uo.NORMAL:return t(ni());case uo.LOGGING:var c=(r=e,o=n,i=[],u=(new Date).getTime(),{logEventCut:function(n,e,t){i.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){i.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){i.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){i.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){i.push({outcome:"response",purpose:t,target:e})},write:function(){var n=(new Date).getTime();P(["mousemove","mouseover","mouseout",qr()],r)||b.console.log(r,{event:r,time:n-u,target:o.dom(),sequence:j(i,function(n){return P(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+Yo(n.target)+")":n.outcome})})}}),a=t(c);return c.write(),a;case uo.STOP:return!0}},Jo=["alloy/data/Fields","alloy/debugging/Debugging"],Zo=function(n,e,t){return $o(n,e,t)},ni=W({logEventCut:y,logEventStopped:y,logNoParent:y,logEventNoHandlers:y,logEventResponse:y,write:y}),ei=function(n,e){return t=l.apply(void 0,[n.handler].concat(e)),r=n.purpose(),{cHandler:t,purpose:W(r)};var t,r},ti=function(n){return n.cHandler},ri=function(n,e,t){return ao(n,function(n){return Xn(n,e)},t)},oi=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),Qn(o)?A.none():A.from(o.querySelector(t)).map(_.fromDom);var t,r,o},ii=function(n,e,t){return oo(Xn,ri,n,e,t)},ui=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?A.none():A.some(e.touches[0])},ci=function(t){var r,o,i,u=ce(A.none()),c=(r=function(n){u.set(A.none()),t.triggerEvent(zr(),n)},o=400,i=null,{cancel:function(){null!==i&&(b.clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i=b.setTimeout(function(){r.apply(null,n),i=null},o)}}),a=pt([{key:Er(),value:function(t){return ui(t).each(function(n){c.cancel();var e={x:W(n.clientX),y:W(n.clientY),target:t.target};c.schedule(t),u.set(A.some(e))}),A.none()}},{key:kr(),value:function(n){return c.cancel(),ui(n).each(function(i){u.get().each(function(n){var e,t,r,o;e=i,t=n,r=Math.abs(e.clientX-t.x()),o=Math.abs(e.clientY-t.y()),(5<r||5<o)&&u.set(A.none())})}),A.none()}},{key:Cr(),value:function(e){return c.cancel(),u.get().filter(function(n){return $n(n.target(),e.target())}).map(function(n){return t.triggerEvent(Ur(),e)})}}]);return{fireIfReady:function(e,n){return gt(a,n).bind(function(n){return n(e)})}}},ai=function(n){var e,t;return 8===n.raw().which&&!P(["input","textarea"],de(n.target()))&&(e=n.target(),!ii(e,'[contenteditable="true"]',t).isSome())},si=Wn.detect().browser.isFirefox(),fi=Yt([(Xo="triggerEvent",dr(Xo,fr)),hr("stopBackspace",!0)]),li=function(e,n){var t,r,o,i,u=ur("Getting GUI events settings",fi,n),c=Wn.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],a=ci(u),s=j(c.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),function(n){return C(e,n,function(e){a.fireIfReady(e,n).each(function(n){n&&e.kill()}),u.triggerEvent(n,e)&&e.kill()})}),f=ce(A.none()),l=C(e,"paste",function(e){a.fireIfReady(e,"paste").each(function(n){n&&e.kill()}),u.triggerEvent("paste",e)&&e.kill(),f.set(A.some(b.setTimeout(function(){u.triggerEvent(Pr(),e)},0)))}),d=C(e,"keydown",function(n){u.triggerEvent("keydown",n)?n.kill():!0===u.stopBackspace&&ai(n)&&n.prevent()}),m=(t=e,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},si?T(t,"focus",r):C(t,"focusin",r)),g=ce(A.none()),v=(o=e,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),g.set(A.some(b.setTimeout(function(){u.triggerEvent(Ir(),n)},0)))},si?T(o,"blur",i):C(o,"focusout",i));return{unbind:function(){L(s,function(n){n.unbind()}),d.unbind(),m.unbind(),v.unbind(),l.unbind(),f.get().each(b.clearTimeout),g.get().each(b.clearTimeout)}}},di=function(n,e){var t=gt(n,"target").map(function(n){return n()}).getOr(e);return ce(t)},mi=Je([{stopped:[]},{resume:["element"]},{complete:[]}]),gi=function(n,r,e,t,o,i){var u,c,a,s,f=n(r,t),l=(u=e,c=o,a=ce(!1),s=ce(!1),{stop:function(){a.set(!0)},cut:function(){s.set(!0)},isStopped:a.get,isCut:s.get,event:W(u),setSource:c.set,getSource:c.get});return f.fold(function(){return i.logEventNoHandlers(r,t),mi.complete()},function(e){var t=e.descHandler();return ti(t)(l),l.isStopped()?(i.logEventStopped(r,e.element(),t.purpose()),mi.stopped()):l.isCut()?(i.logEventCut(r,e.element(),t.purpose()),mi.complete()):ne(e.element()).fold(function(){return i.logNoParent(r,e.element(),t.purpose()),mi.complete()},function(n){return i.logEventResponse(r,e.element(),t.purpose()),mi.resume(n)})})},vi=function(e,t,r,n,o,i){return gi(e,t,r,n,o,i).fold(function(){return!0},function(n){return vi(e,t,r,n,o,i)},function(){return!1})},pi=function(n,e,t){var r,o,i=(r=e,o=ce(!1),{stop:function(){o.set(!0)},cut:y,isStopped:o.get,isCut:W(!1),event:W(r),setSource:u("Cannot set source of a broadcasted event"),getSource:u("Cannot get source of a broadcasted event")});return L(n,function(n){var e=n.descHandler();ti(e)(i)}),i.isStopped()},hi=function(n,e,t,r,o){var i=di(t,r);return vi(n,e,t,r,i,o)},bi=0,yi=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++bi+String(e)},wi=W("alloy-id-"),Oi=W("data-alloy-id"),_i=wi(),xi=Oi(),Si=function(n,e){Object.defineProperty(n.dom(),xi,{value:e,writable:!0})},Ei=function(n){var e=ge(n)?n.dom()[xi]:null;return A.from(e)},ki=function(n){return yi(n)},Ci=rn("element","descHandler"),Ti=function(n,e){return{id:W(n),descHandler:W(e)}};function Di(){var i={};return{registerId:function(r,o,n){cn(n,function(n,e){var t=void 0!==i[e]?i[e]:{};t[o]=ei(n,r),i[e]=t})},unregisterId:function(t){cn(i,function(n,e){n.hasOwnProperty(t)&&delete n[t]})},filterByType:function(n){return gt(i,n).map(function(n){return fn(n,function(n,e){return Ti(e,n)})}).getOr([])},find:function(n,e,t){var o=dt(e)(i);return lo(t,function(n){return t=o,Ei(r=n).fold(function(){return A.none()},function(n){var e=dt(n);return t.bind(e).map(function(n){return Ci(r,n)})});var t,r},n)}}}function Mi(){var r=Di(),o={},i=function(r){var n=r.element();return Ei(n).fold(function(){return n="uid-",e=r.element(),t=yi(_i+n),Si(e,t),t;var n,e,t},function(n){return n})},u=function(n){Ei(n.element()).each(function(n){delete o[n],r.unregisterId(n)})};return{find:function(n,e,t){return r.find(n,e,t)},filter:function(n){return r.filterByType(n)},register:function(n){var e=i(n);bt(o,e)&&function(n,e){var t=o[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+Yo(t.element())+"\nCannot use it for: "+Yo(n.element())+"\nThe conflicting element is"+(xe(t.element())?" ":" not ")+"already in the DOM");u(n)}(n,e);var t=[n];r.registerId(t,e,n.events()),o[e]=n},unregister:u,getById:function(n){return dt(n)(o)}}}var Ni,Ai,Fi=mo([(Ni=Rr(),Ai=function(n,e){var t,r,o=e.event().originator(),i=e.event().target();return r=i,!($n(t=o,n.element())&&!$n(t,r)&&(b.console.warn(Rr()+" did not get interpreted by the desired target. \nOriginator: "+Yo(o)+"\nTarget: "+Yo(i)+"\nCheck the "+Rr()+" event handlers"),1))},{key:Ni,value:xr({can:Ai})})]),Bi=Object.freeze({events:Fi}),Hi=s,Ri=function(e){var n=function(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+Yo(e().element())+" is not in context.")}};return{debugInfo:W("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),broadcastEvent:n("broadcastEvent"),isConnected:W(!1)}},Ii=Ri(),Pi=yi("alloy-premade"),Vi=function(n){return vt(Pi,n)},ji=function(r){return n=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return r.apply(void 0,[n.getApis()].concat([n].concat(e)))},e=r.toString(),t=e.indexOf(")")+1,o=e.indexOf("("),i=e.substring(o+1,t-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Oo(i.slice(1))}},n;var n,e,t,o,i},Li=function(n,o){var i={};return cn(n,function(n,r){cn(n,function(n,e){var t=mt(e,[])(i);i[e]=t.concat([o(r,n)])})}),i},Ui=function(n,e){return{name:W(n),handler:W(e)}},Wi=function(n,e,t){var r,o,i=Ce({},t,(r=n,o={},L(e,function(n){o[n.name()]=n.handlers(r)}),o));return Li(i,Ui)},zi=function(n){var e,i=H(e=n)?{can:W(!0),abort:W(!1),run:e}:e;return function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=[n,e].concat(t);i.abort.apply(void 0,o)?e.stop():i.can.apply(void 0,o)&&i.run.apply(void 0,o)}},Gi=function(n,e,t){var r,o,i=e[t];return i?function(u,c,n,a){var e=n.slice(0);try{var t=e.sort(function(n,e){var t=n[c](),r=e[c](),o=a.indexOf(t),i=a.indexOf(r);if(-1===o)throw new Error("The ordering for "+u+" does not have an entry for "+t+".\nOrder specified: "+Vt(a,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+r+".\nOrder specified: "+Vt(a,null,2));return o<i?-1:i<o?1:0});return Fe.value(t)}catch(n){return Fe.error([n])}}("Event: "+t,"name",n,i).map(function(n){var e=j(n,function(n){return n.handler()});return Sr(e)}):(r=t,o=n,Fe.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+Vt(j(o,function(n){return n.name()}),null,2)]))},qi=function(n,i){var e=fn(n,function(r,o){return(1===r.length?Fe.value(r[0].handler()):Gi(r,i,o)).map(function(n){var e=zi(n),t=1<r.length?U(i,function(e){return P(r,function(n){return n.name()===e})}).join(" > "):r[0].name();return vt(o,{handler:e,purpose:W(t)})})});return ht(e,{})},Yi=function(n){return or("custom.definition",Kt([Jt("dom","dom",it(),Kt([lr("tag"),hr("styles",{}),hr("classes",[]),hr("attributes",{}),gr("value"),gr("innerHtml")])),lr("components"),lr("uid"),hr("events",{}),hr("apis",{}),Jt("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling","typeaheadevents"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing","item-events","tooltipping"],mousedown:["focusing","alloy.base.behaviour","item-type-events"],mouseover:["item-type-events","tooltipping"]},rt.mergeWithThunk(W(e))),sr()),gr("domModification")]),n);var e},Ki=function(e,n){L(n,function(n){Ue(e,n)})},Xi=function(e,n){L(n,function(n){ze(e,n)})},Qi=function(n){return void 0!==n.style},$i=function(n,e,t){if(!M(t))throw b.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);Qi(n)&&n.style.setProperty(e,t)},Ji=function(n,e){Qi(n)&&n.style.removeProperty(e)},Zi=function(n,e,t){var r=n.dom();$i(r,e,t)},nu=function(n,e){var t=n.dom();cn(e,function(n,e){$i(t,e,n)})},eu=function(n,e){var t=n.dom(),r=b.window.getComputedStyle(t).getPropertyValue(e),o=""!==r||xe(n)?r:tu(t,e);return null===o?void 0:o},tu=function(n,e){return Qi(n)?n.style.getPropertyValue(e):""},ru=function(n,e){var t=n.dom(),r=tu(t,e);return A.from(r).filter(function(n){return 0<n.length})},ou=function(n,e){var t=n.dom();Ji(t,e),Oe(n,"style")&&""===we(n,"style").replace(/^\s+|\s+$/g,"")&&_e(n,"style")},iu=function(n){return n.dom().value},uu=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},cu=function(n,e){return t=n,o=j(r=e,function(n){return vr(n.name(),[lr("config"),hr("state",wr)])}),i=or("component.behaviours",Kt(o),t.behaviours).fold(function(n){throw new Error(cr(n)+"\nComplete spec:\n"+Vt(t,null,2))},function(n){return n}),{list:r,data:an(i,function(n){var e=n.map(function(n){return{config:n.config,state:n.state.init(n.config)}});return function(){return e}})};var t,r,o,i},au=function(n){var e,t,r,o=(e=n,t=mt("behaviours",{})(e),r=U(on(t),function(n){return void 0!==t[n]}),j(r,function(n){return t[n].me}));return cu(n,o)},su=function(n,e,t){var r,o,i,u=Ce({},(r=n).dom,{uid:r.uid,domChildren:j(r.components,function(n){return n.element()})}),c=n.domModification.fold(function(){return xo({})},xo),a={"alloy.base.modification":c},s=0<e.length?function(e,n,t,r){var o=Ce({},n);L(t,function(n){o[n.name()]=n.exhibit(e,r)});var i=Li(o,function(n,e){return{name:n,modification:e}}),u=function(n){return z(n,function(n,e){return Ce({},e.modification,n)},{})},c=z(i.classes,function(n,e){return e.modification.concat(n)},[]),a=u(i.attributes),s=u(i.styles);return xo({classes:c,attributes:a,styles:s})}(t,a,e,u):c;return i=s,Ce({},o=u,{attributes:Ce({},o.attributes,i.attributes),styles:Ce({},o.styles,i.styles),classes:o.classes.concat(i.classes)})},fu=function(n,e,t){var r,o,i,u,c,a,s={"alloy.base.behaviour":(r=n,r.events)};return(o=t,i=n.eventOrder,u=e,c=s,a=Wi(o,u,c),qi(a,i)).getOrDie()},lu=function(t){var n=function(){return f},r=ce(Ii),e=ir(Yi(t)),o=au(t),i=o.list,u=o.data,c=function(n){var e=_.fromTag(n.tag);ye(e,n.attributes),Ki(e,n.classes),nu(e,n.styles),n.innerHtml.each(function(n){return zo(e,n)});var t=n.domChildren;return Po(e,t),n.value.each(function(n){uu(e,n)}),n.uid,Si(e,n.uid),e}(su(e,i,u)),a=fu(e,i,u),s=ce(e.components),f={getSystem:r.get,config:function(n){var e=u;return(H(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+Vt(t,null,2))})()},hasConfigured:function(n){return H(u[n.name()])},spec:W(t),readState:function(n){return u[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},getApis:function(){return e.apis},connect:function(n){r.set(n)},disconnect:function(){r.set(Ri(n))},element:W(c),syncComponents:function(){var n=ee(c),e=$(n,function(n){return r.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});s.set(e)},components:s.get,events:W(a)};return f},du=function(n){var e,t,r=Hi(n),o=r.events,i=Te(r,["events"]),u=(e=i,t=mt("components",[])(e),j(t,vu)),c=Ce({},i,{events:Ce({},Bi,o),components:u});return Fe.value(lu(c))},mu=function(n){var e=ur("external.component",Yt([lr("element"),gr("uid")]),n),t=ce(Ri());e.uid.each(function(n){Si(e.element,n)});var r={getSystem:t.get,config:A.none,hasConfigured:W(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(Ri(function(){return r}))},getApis:function(){return{}},element:W(e.element),spec:W(n),readState:W("No state"),syncComponents:y,components:W([]),events:W({})};return Vi(r)},gu=ki,vu=function(e){return(n=e,gt(n,Pi)).fold(function(){var n=e.hasOwnProperty("uid")?e:Ce({uid:gu("")},e);return du(n).getOrDie()},function(n){return n});var n},pu=Vi,hu=function(r,n){return e=r,t={},o=j(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+r,Jt(e,e,ut(),qt(function(n){return Tt("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([yr("dump",s)]),Jt(e,e,ot(t),Kt(o));var e,t,o},bu=function(n){return n.dump},yu=function(n,e){return Ce({},n.dump,Do(e))},wu=hu,Ou=yu,_u=W([lr("menu"),lr("selectedMenu")]),xu=W([lr("item"),lr("selectedItem")]),Su=(W(Kt(xu().concat(_u()))),W(Kt(xu()))),Eu=mr("initSize",[lr("numColumns"),lr("numRows")]),ku=function(){return mr("markers",[lr("backgroundMenu")].concat(_u()).concat(xu()))},Cu=function(n,e,t){return function(){var n=new Error;if(void 0!==n.stack){var e=n.stack.split("\n");q(e,function(e){return 0<e.indexOf("alloy")&&!V(Jo,function(n){return-1<e.indexOf(n)})}).getOr(Ko)}}(),Jt(e,e,t,tr(function(t){return Fe.value(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(void 0,n)})}))},Tu=function(n){return Cu(0,n,ot(y))},Du=function(n){return Cu(0,n,ot(A.none))},Mu=function(n){return Cu(0,n,it())},Nu=function(n){return Cu(0,n,it())},Au=function(n,e){return yr(n,W(e))},Fu=function(n){return yr(n,s)},Bu=W(Eu),Hu="placeholder",Ru=Je([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Iu=function(n,e,t,r){return t.uiType===Hu?(i=t,u=r,(o=n).exists(function(n){return n!==i.owner})?Ru.single(!0,W(i)):gt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+on(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+Vt(i,null,2))},function(n){return n.replace()})):Ru.single(!1,W(t));var o,i,u},Pu=function(i,u,c,a){return Iu(i,0,c,a).fold(function(n,e){var t=e(u,c.config,c.validated),r=gt(t,"components").getOr([]),o=$(r,function(n){return Pu(i,u,n,a)});return[Ce({},t,{components:o})]},function(n,e){var t=e(u,c.config,c.validated);return c.validated.preprocess.getOr(s)(t)})},Vu=function(e,t,n,r){var o,i,u,c=an(r,function(n,e){return r=n,o=!1,{name:W(t=e),required:function(){return r.fold(function(n,e){return n},function(n,e){return n})},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+t);return o=!0,r}};var t,r,o}),a=(o=e,i=t,u=c,$(n,function(n){return Pu(o,i,n,u)}));return cn(c,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+Vt(t.components,null,2))}),a},ju=Ru.single,Lu=Ru.multiple,Uu=W(Hu),Wu=Je([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),zu=hr("factory",{sketch:s}),Gu=hr("schema",[]),qu=lr("name"),Yu=Jt("pname","pname",ct(function(n){return"<alloy."+yi(n.name)+">"}),sr()),Ku=yr("schema",function(){return[gr("preprocess")]}),Xu=hr("defaults",W({})),Qu=hr("overrides",W({})),$u=Kt([zu,Gu,qu,Yu,Xu,Qu]),Ju=Kt([zu,Gu,qu,Xu,Qu]),Zu=Kt([zu,Gu,qu,Yu,Xu,Qu]),nc=Kt([zu,Ku,qu,lr("unit"),Yu,Xu,Qu]),ec=function(n){var e=function(n){return n.name};return n.fold(e,e,e,e)},tc=function(t,r){return function(n){var e=ur("Converting part type",r,n);return t(e)}},rc=tc(Wu.required,$u),oc=tc(Wu.external,Ju),ic=tc(Wu.optional,Zu),uc=tc(Wu.group,nc),cc=W("entirety"),ac=function(n,e,t,r){return et(e.defaults(n,t,r),t,{uid:n.partUids[e.name]},e.overrides(n,t,r))},sc=function(o,n){var i={};return L(n,function(n){var e;(e=n,e.fold(A.some,A.none,A.some,A.some)).each(function(t){var r=fc(o,t.pname);i[t.name]=function(n){var e=ur("Part: "+t.name+" in "+o,Kt(t.schema),n);return Ce({},r,{config:n,validated:e})}})}),i},fc=function(n,e){return{uiType:Uu(),owner:n,name:e}},lc=function(n,e,t){return r=e,i={},o={},L(t,function(n){n.fold(function(r){i[r.pname]=ju(!0,function(n,e,t){return r.factory.sketch(ac(n,r,e,t))})},function(n){var e=r.parts[n.name];o[n.name]=W(n.factory.sketch(ac(r,n,e[cc()]),e))},function(r){i[r.pname]=ju(!1,function(n,e,t){return r.factory.sketch(ac(n,r,e,t))})},function(o){i[o.pname]=Lu(!0,function(e,n,t){var r=e[o.name];return j(r,function(n){return o.factory.sketch(et(o.defaults(e,n,t),n,o.overrides(e,n)))})})})}),{internals:W(i),externals:W(o)};var r,i,o},dc=function(n,e,t){return Vu(A.some(n),e,e.components,t)},mc=function(e,n){var t=j(n,ec);return pt(j(t,function(n){return{key:n,value:e+"-"+n}}))},gc=function(e){return Jt("partUids","partUids",at(function(n){return mc(n.uid,e)}),sr())},vc=function(n,e,t,r,o){var i,u,c=(u=o,(0<(i=r).length?[mr("parts",i)]:[]).concat([lr("uid"),hr("dom",{}),hr("components",[]),Fu("originalSpec"),hr("debug.sketcher",{})]).concat(u));return ur(n+" [SpecSchema]",Yt(c.concat(e)),t)},pc=function(n,e,t,r,o){var i=hc(o),u=$(t,function(n){return n.fold(A.none,A.some,A.none,A.none).map(function(n){return mr(n.name,n.schema.concat([Fu(cc())]))}).toArray()}),c=gc(t),a=vc(n,e,i,u,[c]),s=lc(0,a,t);return r(a,dc(n,a,s.internals()),i,s.externals())},hc=function(n){return n.hasOwnProperty("uid")?n:Ce({},n,{uid:ki("uid")})},bc=Yt([lr("name"),lr("factory"),lr("configFields"),hr("apis",{}),hr("extraApis",{})]),yc=Yt([lr("name"),lr("factory"),lr("configFields"),lr("partFields"),hr("apis",{}),hr("extraApis",{})]),wc=function(n){var i=ur("Sketcher for "+n.name,bc,n),e=an(i.apis,ji),t=an(i.extraApis,function(n,e){return _o(n,e)});return Ce({name:W(i.name),partFields:W([]),configFields:W(i.configFields),sketch:function(n){return e=i.name,t=i.configFields,r=i.factory,o=hc(n),r(vc(e,t,o,[],[]),o);var e,t,r,o}},e,t)},Oc=function(n){var e=ur("Sketcher for "+n.name,yc,n),t=sc(e.name,e.partFields),r=an(e.apis,ji),o=an(e.extraApis,function(n,e){return _o(n,e)});return Ce({name:W(e.name),partFields:W(e.partFields),configFields:W(e.configFields),sketch:function(n){return pc(e.name,e.configFields,e.partFields,e.factory,n)},parts:W(t)},r,o)},_c=(wc({name:"Container",factory:function(n){var e=n.dom,t=e.attributes,r=Te(e,["attributes"]);return{uid:n.uid,dom:Ce({tag:"div",attributes:Ce({role:"presentation"},t)},r),components:n.components,behaviours:bu(n.containerBehaviours),events:n.events,domModification:n.domModification,eventOrder:n.eventOrder}},configFields:[hr("components",[]),hu("containerBehaviours",[]),hr("events",{}),hr("domModification",{}),hr("eventOrder",{})]}),function(n){Zr(n,Kr());var e=n.components();L(e,_c)}),xc=function(n){var e=n.components();L(e,xc),Zr(n,Yr())},Sc=function(n,e){Ec(n,e,ue)},Ec=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),xe(n.element())&&xc(e),n.syncComponents()},kc=function(n){_c(n),jo(n.element()),n.getSystem().removeFromWorld(n)},Cc=function(e){var n=ne(e.element()).bind(function(n){return e.getSystem().getByDom(n).fold(A.none,A.some)});kc(e),n.each(function(n){n.syncComponents()})},Tc=function(n){var e=n.components();L(e,kc),Vo(n.element()),n.syncComponents()},Dc=function(t){var r=function(e){return ne(t.element()).fold(function(){return!0},function(n){return $n(e,n)})},o=Mi(),s=function(n,e){return o.find(r,n,e)},n=li(t.element(),{triggerEvent:function(u,c){return Zo(u,c.target(),function(n){return e=s,t=u,o=n,i=(r=c).target(),hi(e,t,r,i,o);var e,t,r,o,i})}}),i={debugInfo:W("real"),triggerEvent:function(e,t,r){Zo(e,t,function(n){hi(s,e,r,t,n)})},triggerFocus:function(c,a){Ei(c).fold(function(){Ho(c)},function(n){Zo(Rr(),c,function(n){var e,t,r,o,i,u;e=s,t=Rr(),r={originator:W(a),kill:y,prevent:y,target:W(c)},i=n,u=di(r,o=c),gi(e,t,r,o,u,i)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return g(n)},getByDom:function(n){return v(n)},build:vu,addToGui:function(n){c(n)},removeFromGui:function(n){a(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){u(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},broadcastEvent:function(n,e){m(n,e)},isConnected:W(!0)},e=function(n){n.connect(i),ve(n.element())||(o.register(n),L(n.components(),e),i.triggerEvent(qr(),n.element(),{target:W(n.element())}))},u=function(n){ve(n.element())||(L(n.components(),u),o.unregister(n)),n.disconnect()},c=function(n){Sc(t,n)},a=function(n){Cc(n)},f=function(t){var n=o.filter(Vr());L(n,function(n){var e=n.descHandler();ti(e)(t)})},l=function(n){f({universal:W(!0),data:W(n)})},d=function(n,e){f({universal:W(!1),channels:W(n),data:W(e)})},m=function(n,e){var t=o.filter(n);return pi(t,e)},g=function(n){return o.getById(n).fold(function(){return Fe.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Fe.value)},v=function(n){var e=Ei(n).getOr("not found");return g(e)};return e(t),{root:W(t),element:t.element,destroy:function(){n.unbind(),jo(t.element())},add:c,remove:a,getByUid:g,getByDom:v,addToWorld:e,removeFromWorld:u,broadcast:l,broadcastOn:d,broadcastEvent:m}},Mc=function(n){var e=void 0!==n.uid&&bt(n,"uid")?n.uid:ki("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(A.none,A.some)},asSpec:function(){return Ce({},n,{uid:e})}}},Nc=Object.freeze({exhibit:function(n,e){return xo({classes:[],styles:e.useFixed?{}:{position:"relative"}})}}),Ac=function(t,r){return{left:W(t),top:W(r),translate:function(n,e){return Ac(t+n,r+e)}}},Fc=Ac,Bc=function(n,e){return void 0!==n?n:void 0!==e?e:0},Hc=function(n){var e,t,r=n.dom().ownerDocument,o=r.body,i=(e=_.fromDom(r),(t=e.dom())===t.window&&e instanceof b.Window?e:pe(e)?t.defaultView||t.parentWindow:null),u=r.documentElement,c=Bc(i.pageYOffset,u.scrollTop),a=Bc(i.pageXOffset,u.scrollLeft),s=Bc(u.clientTop,o.clientTop),f=Bc(u.clientLeft,o.clientLeft);return Rc(n).translate(a-f,c-s)},Rc=function(n){var e,t,r,o=n.dom(),i=o.ownerDocument,u=i.body,c=_.fromDom(i.documentElement);return u===o?Fc(u.offsetLeft,u.offsetTop):(e=n,t=c||_.fromDom(b.document.documentElement),ao(e,l($n,t)).isSome()?(r=o.getBoundingClientRect(),Fc(r.left,r.top)):Fc(0,0))},Ic=Wn.detect().browser.isSafari(),Pc=function(n){var e=void 0!==n?n.dom():b.document,t=e.body.scrollLeft||e.documentElement.scrollLeft,r=e.body.scrollTop||e.documentElement.scrollTop;return Fc(t,r)},Vc=function(n,e){Ic&&H(n.dom().scrollIntoViewIfNeeded)?n.dom().scrollIntoViewIfNeeded(!1):n.dom().scrollIntoView(e)};function jc(r,o){var n=function(n){var e=o(n);if(e<=0||null===e){var t=eu(n,r);return parseFloat(t)||0}return e},i=function(o,n){return G(n,function(n,e){var t=eu(o,e),r=void 0===t?0:parseInt(t,10);return isNaN(r)?n:n+r},0)};return{set:function(n,e){if(!R(e)&&!e.match(/^[0-9]+$/))throw new Error(r+".set accepts only positive integer values. Value was "+e);var t=n.dom();Qi(t)&&(t.style[r]=e+"px")},get:n,getOuter:n,aggregate:i,max:function(n,e,t){var r=i(n,t);return r<e?e-r:0}}}var Lc,Uc,Wc,zc,Gc,qc,Yc,Kc,Xc=jc("width",function(n){return n.dom().offsetWidth}),Qc=function(n){return Xc.getOuter(n)},$c=jc("height",function(n){var e=n.dom();return xe(n)?e.getBoundingClientRect().height:e.offsetHeight}),Jc=function(n){return $c.getOuter(n)},Zc=gn(["x","y","width","height","maxHeight","direction","classes","label","candidateYforTest"],[]),na=rn("position","left","top","right","bottom"),ea=Je([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),ta=ea.southeast,ra=ea.southwest,oa=ea.northeast,ia=ea.northwest,ua=ea.south,ca=ea.north,aa=ea.east,sa=ea.west,fa=rn("point","width","height"),la=rn("x","y","width","height"),da=function(n,e,t,r){return{x:W(n),y:W(e),width:W(t),height:W(r),right:W(n+t),bottom:W(e+r)}},ma=function(r,n){return r.view(n).fold(W([]),function(n){var e=r.owner(n),t=ma(r,e);return[n].concat(t)})},ga=Object.freeze({view:function(n){return(n.dom()===b.document?A.none():A.from(n.dom().defaultView.frameElement)).map(_.fromDom)},owner:function(n){return Jn(n)}}),va=function(r){var n,e,t,o,i=_.fromDom(b.document),u=Pc(i);return(n=r,t=(e=ga).owner(n),o=ma(e,t),A.some(o)).fold(l(Hc,r),function(n){var e=Rc(r),t=z(n,function(n,e){var t=Rc(e);return{left:n.left+t.left(),top:n.top+t.top()}},{left:0,top:0});return Fc(t.left+e.left()+u.left(),t.top+e.top()+u.top())})},pa=function(){var n=b.window.innerWidth,e=b.window.innerHeight,t=_.fromDom(b.document),r=Pc(t);return da(r.left(),r.top(),n,e)},ha=Je([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),ba=function(n,e,t,r,o,i){var u,c,a,s,f,l,d,m,g,v=e.x()-t,p=e.y()-r,h=o-(v+e.width()),b=i-(p+e.height()),y=A.some(v),w=A.some(p),O=A.some(h),_=A.some(b),x=A.none();return u=e.direction(),c=function(){return na(n,y,w,x,x)},a=function(){return na(n,x,w,O,x)},s=function(){return na(n,y,x,x,_)},f=function(){return na(n,x,x,O,_)},l=function(){return na(n,y,w,x,x)},d=function(){return na(n,y,x,x,_)},m=function(){return na(n,y,w,x,x)},g=function(){return na(n,x,w,O,x)},u.fold(c,a,s,f,l,d,m,g)},ya=function(n,e){var t=l(va,e),r=n.fold(t,t,function(){var n=Pc();return va(e).translate(-n.left(),-n.top())}),o=Qc(e),i=Jc(e);return da(r.left(),r.top(),o,i)},wa=ha.relative,Oa=ha.fixed,_a=rn("anchorBox","origin"),xa=Je([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),Sa=function(n,I,P,V,j){var L=P.width(),U=P.height(),r=function(n,r,o,i){var e,t,u,c,a,s,f,l,d,m,g,v,p,h,b,y,w,O,_,x,S,E,k,C,T,D,M,N,A,F,B,H,R=n(I,P,V);return(t=L,u=U,c=j,d=(e=R).x(),m=e.y(),g=e.bubble().offset().left(),v=e.bubble().offset().top(),p=c.x(),h=c.y(),b=c.width(),y=c.height(),x=h<=(O=m+v),S=(_=p<=(w=d+g))&&x,E=w+t<=p+b&&O+u<=h+y,k=_?Math.min(t,p+b-w):Math.abs(p-(w+t)),C=x?Math.min(u,h+y-O):Math.abs(h-(O+u)),T=c.x()+c.width(),D=Math.max(c.x(),w),M=Math.min(D,T),A=W((N=x?O:O+(u-C))+C-h),F=W(h+y-N),a=e.direction(),f=s=F,l=A,B=a.fold(s,s,l,l,s,l,f,f),H=Zc({x:M,y:N,width:k,height:C,maxHeight:B,direction:e.direction(),classes:{on:e.bubble().classesOn(),off:e.bubble().classesOff()},label:e.label(),candidateYforTest:O}),S&&E?xa.fit(H):xa.nofit(H,k,C)).fold(xa.fit,function(n,e,t){return i<t||o<e?xa.nofit(n,e,t):xa.nofit(r,o,i)})};return G(n,function(n,e){var t=l(r,e);return n.fold(xa.fit,t)},xa.nofit(Zc({x:I.x(),y:I.y(),width:P.width(),height:P.height(),maxHeight:P.height(),direction:ta(),classes:[],label:"none",candidateYforTest:I.y()}),-1,-1)).fold(s,s)},Ea=function(n,e,t,r){ou(e,"max-height");var o,i={width:W(Qc(o=e)),height:W(Jc(o))};return Sa(r.preference(),n,i,t,r.bounds())},ka=function(n,e,t){var r,o,i,u,c,a=function(n){return n+"px"},s=(r=t.origin(),o=e,r.fold(function(){return na("absolute",A.some(o.x()),A.some(o.y()),A.none(),A.none())},function(n,e,t,r){return ba("absolute",o,n,e,t,r)},function(n,e,t,r){return ba("fixed",o,n,e,t,r)}));i=n,u={position:A.some(s.position()),left:s.left().map(a),top:s.top().map(a),right:s.right().map(a),bottom:s.bottom().map(a)},c=i.dom(),cn(u,function(n,e){n.fold(function(){Ji(c,e)},function(n){$i(c,e,n)})})},Ca=function(n,e){var t,r,o;t=n,r=Math.floor(e),o=$c.max(t,r,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]),Zi(t,"max-height",o+"px")},Ta=W(function(n,e){Ca(n,e),nu(n,{"overflow-x":"hidden","overflow-y":"auto"})}),Da=gn(["bounds","origin","preference","maxHeightFunction"],[]),Ma=function(n,e,t,r,o,i){var u,c,a,s,f,l=(u=i,c="maxHeightFunction",a=Ta(),void 0===u[c]?a:u[c]),d=n.anchorBox(),m=n.origin(),g=Da({bounds:(s=m,f=o,f.fold(function(){return s.fold(pa,pa,da)},function(n){return s.fold(n,n,da)})),origin:m,preference:r,maxHeightFunction:l});Na(d,e,t,g)},Na=function(n,e,t,r){var o,i,u,c,a=Ea(n,e,t,r);ka(e,a,r),o=e,i=a.classes(),Xi(o,i.off),Ki(o,i.on),u=e,c=a,r.maxHeightFunction()(u,c.maxHeight())},Aa=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right"],Fa=function(){return e=n=0,t={},o=function(n){return gt(t,n).getOr([])},r=function(n,e,t){var r=en(Aa,t);return{offset:function(){return Fc(n,e)},classesOn:function(){return $(t,o)},classesOff:function(){return $(r,o)}}},{southeast:function(){return r(-n,e,["top","alignLeft"])},southwest:function(){return r(n,e,["top","alignRight"])},south:function(){return r(-n/2,e,["top","alignCentre"])},northeast:function(){return r(-n,-e,["bottom","alignLeft"])},northwest:function(){return r(n,-e,["bottom","alignRight"])},north:function(){return r(-n/2,-e,["bottom","alignCentre"])},east:function(){return r(n,-e/2,["valignCentre","left"])},west:function(){return r(-n,-e/2,["valignCentre","right"])}};var n,e,t,o,r},Ba=rn("x","y","bubble","direction","label"),Ha=function(n){return n.x()},Ra=function(n,e){return n.x()+n.width()/2-e.width()/2},Ia=function(n,e){return n.x()+n.width()-e.width()},Pa=function(n,e){return n.y()-e.height()},Va=function(n){return n.y()+n.height()},ja=function(n,e){return n.y()+n.height()/2-e.height()/2},La=function(n,e,t){return Ba(Ha(n),Va(n),t.southeast(),ta(),"layout-se")},Ua=function(n,e,t){return Ba(Ia(n,e),Va(n),t.southwest(),ra(),"layout-sw")},Wa=function(n,e,t){return Ba(Ha(n),Pa(n,e),t.northeast(),oa(),"layout-ne")},za=function(n,e,t){return Ba(Ia(n,e),Pa(n,e),t.northwest(),ia(),"layout-nw")},Ga=function(n,e,t){return Ba(Ra(n,e),Pa(n,e),t.north(),ca(),"layout-n")},qa=function(n,e,t){return Ba(Ra(n,e),Va(n),t.south(),ua(),"layout-s")},Ya=function(n,e,t){return Ba((r=n).x()+r.width(),ja(n,e),t.east(),aa(),"layout-e");var r},Ka=function(n,e,t){return Ba((r=e,n.x()-r.width()),ja(n,e),t.west(),sa(),"layout-w");var r},Xa=function(){return[La,Ua,Wa,za,qa,Ga,Ya,Ka]},Qa=function(){return[Ua,La,za,Wa,qa,Ga,Ya,Ka]},$a=function(n){return n},Ja=function(e,t){return function(n){return"rtl"===Za(n)?t:e}},Za=function(n){return"rtl"===eu(n,"direction")?"rtl":"ltr"},ns=function(){return vr("layouts",[lr("onLtr"),lr("onRtl")])},es=function(e,n,t,r){var o=n.layouts.map(function(n){return n.onLtr(e)}).getOr(t),i=n.layouts.map(function(n){return n.onRtl(e)}).getOr(r);return Ja(o,i)(e)},ts=[lr("hotspot"),gr("bubble"),ns(),Au("placement",function(n,e,t){var r=e.hotspot,o=ya(t,r.element()),i=es(n.element(),e,Xa(),Qa());return A.some($a({anchorBox:o,bubble:e.bubble.getOr(Fa()),overrides:{},layouts:i,placer:A.none()}))})],rs=[lr("x"),lr("y"),hr("height",0),hr("width",0),hr("bubble",Fa()),ns(),Au("placement",function(n,e,t){var r=da(e.x,e.y,e.width,e.height),o=es(n.element(),e,Xa(),Qa());return A.some($a({anchorBox:r,bubble:e.bubble,overrides:{},layouts:o,placer:A.none()}))})],os=(Je([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Je([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}])),is=rn("start","soffset","finish","foffset"),us=os.exact,cs=function(n,e,t,r){var o,i,u,c,a,s=(i=e,u=t,c=r,(a=Jn(o=n).dom().createRange()).setStart(o.dom(),i),a.setEnd(u.dom(),c),a),f=$n(n,t)&&e===r;return s.collapsed&&!f},as=function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold(function(n){r.setStartBefore(n.dom())},function(n,e){r.setStart(n.dom(),e)},function(n){r.setStartAfter(n.dom())}),o=i,t.fold(function(n){o.setEndBefore(n.dom())},function(n,e){o.setEnd(n.dom(),e)},function(n){o.setEndAfter(n.dom())}),i},ss=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},fs=function(n){return{left:W(n.left),top:W(n.top),right:W(n.right),bottom:W(n.bottom),width:W(n.width),height:W(n.height)}},ls=Je([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),ds=function(n,e,t){return e(_.fromDom(t.startContainer),t.startOffset,_.fromDom(t.endContainer),t.endOffset)},ms=function(n,e){var o,t,r,i=(o=n,e.match({domRange:function(n){return{ltr:W(n),rtl:A.none}},relative:function(n,e){return{ltr:bn(function(){return as(o,n,e)}),rtl:bn(function(){return A.some(as(o,e,n))})}},exact:function(n,e,t,r){return{ltr:bn(function(){return ss(o,n,e,t,r)}),rtl:bn(function(){return A.some(ss(o,t,r,n,e))})}}}));return(r=(t=i).ltr()).collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return ls.rtl(_.fromDom(n.endContainer),n.endOffset,_.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return ds(0,ls.ltr,r)}):ds(0,ls.ltr,r)},gs=(Lc=ve,Uc="text",Wc=function(n){return Lc(n)?A.from(n.dom().nodeValue):A.none()},zc=Wn.detect().browser,{get:function(n){if(!Lc(n))throw new Error("Can only get "+Uc+" value of a "+Uc+" node");return Gc(n).getOr("")},getOption:Gc=zc.isIE()&&10===zc.version.major?function(n){try{return Wc(n)}catch(n){return A.none()}}:Wc,set:function(n,e){if(!Lc(n))throw new Error("Can only set raw "+Uc+" value of a "+Uc+" node");n.dom().nodeValue=e}}),vs=function(n){return gs.get(n)},ps=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var i,t,r,o,u=ms(i=n,e).match({ltr:function(n,e,t,r){var o=i.document.createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},rtl:function(n,e,t,r){var o=i.document.createRange();return o.setStart(t.dom(),r),o.setEnd(n.dom(),e),o}});return r=(t=u).getClientRects(),0<(o=0<r.length?r[0]:t.getBoundingClientRect()).width||0<o.height?A.some(o).map(fs):A.none()}),hs=rn("element","offset"),bs=Je([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),ys=function(n){return n.fold(function(n){return n},function(n,e,t){return n.translate(-e,-t)})},ws=function(n){return n.fold(function(n){return n},function(n,e,t){return n})},Os=function(n){return G(n,function(n,e){return n.translate(e.left(),e.top())},Fc(0,0))},_s=function(n){var e=j(n,ws);return Os(e)},xs=bs.screen,Ss=bs.absolute,Es=function(n,e,t){var r,o,i,u=Jn(n.element()),c=Pc(u),a=(r=n,o=t,i=Zn(o.root).dom(),A.from(i.frameElement).map(_.fromDom).filter(function(n){var e=Jn(n),t=Jn(r.element());return $n(e,t)}).map(Hc)).getOr(c);return Ss(a,c.left(),c.top())},ks=function(n,e,t,r){var o=n,i=e,u=t,c=r;n<0&&(o=0,u=t+n),e<0&&(i=0,c=r+e);var a=xs(Fc(o,i));return A.some(fa(a,u,c))},Cs=function(n,a,s,f,l){return n.map(function(n){var e,t,r,o=[a,n.point()],i=(e=function(){return _s(o)},t=function(){return _s(o)},r=function(){return n=j(o,ys),Os(n);var n},f.fold(e,t,r)),u=la(i.left(),i.top(),n.width(),n.height()),c=es(l,s,s.showAbove?[Wa,za,La,Ua,Ga,qa]:[La,Ua,Wa,za,qa,qa],s.showAbove?[za,Wa,Ua,La,Ga,qa]:[Ua,La,za,Wa,qa,Ga]);return $a({anchorBox:u,bubble:s.bubble.getOr(Fa()),overrides:s.overrides,layouts:c,placer:A.none()})})},Ts=rn("element","offset"),Ds=function(n,e){return ve(n)?Ts(n,e):function(n,e){var t=ee(n);if(0===t.length)return hs(n,e);if(e<t.length)return hs(t[e],0);var r=t[t.length-1],o=ve(r)?vs(r).length:ee(r).length;return hs(r,o)}(n,e)},Ms=function(e,n){return n.getSelection.getOrThunk(function(){return function(){return n=e,A.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind((document.caretPositionFromPoint||document.caretRangeFromPoint,function(n){var e=_.fromDom(n.anchorNode),t=_.fromDom(n.focusNode);return cs(e,n.anchorOffset,t,n.focusOffset)?A.some(is(e,n.anchorOffset,t,n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return A.some(is(_.fromDom(e.startContainer),e.startOffset,_.fromDom(t.endContainer),t.endOffset))}return A.none()}(n)}));var n}})().map(function(n){var e=Ds(n.start(),n.soffset()),t=Ds(n.finish(),n.foffset());return is(e.element(),e.offset(),t.element(),t.offset())})},Ns=[gr("getSelection"),lr("root"),gr("bubble"),ns(),hr("overrides",{}),hr("showAbove",!1),Au("placement",function(n,e,t){var r=Zn(e.root).dom(),o=Es(n,0,e),i=Ms(r,e).bind(function(n){var e;return ps(r,(e=n,os.exact(e.start(),e.soffset(),e.finish(),e.foffset()))).orThunk(function(){var e=_.fromText("\ufeff");return oe(n.start(),e),ps(r,us(e,0,e,1)).map(function(n){return jo(e),n})}).bind(function(n){return ks(n.left(),n.top(),n.width(),n.height())})}),u=Ms(r,e).bind(function(n){return ge(n.start())?A.some(n.start()):ne(n.start())}).getOr(n.element());return Cs(i,o,e,t,u)})],As=[lr("node"),lr("root"),gr("bubble"),ns(),hr("overrides",{}),hr("showAbove",!1),Au("placement",function(o,i,u){var c=Es(o,0,i);return i.node.bind(function(n){var e=n.dom().getBoundingClientRect(),t=ks(e.left,e.top,e.width,e.height),r=i.node.getOr(o.element());return Cs(t,c,i,u,r)})})],Fs=function(n){return n.x()+n.width()},Bs=function(n,e){return n.x()-e.width()},Hs=function(n,e){return n.y()-e.height()+n.height()},Rs=function(n){return n.y()},Is=function(n,e,t){return Ba(Fs(n),Rs(n),t.southeast(),ta(),"link-layout-se")},Ps=function(n,e,t){return Ba(Bs(n,e),Rs(n),t.southwest(),ra(),"link-layout-sw")},Vs=function(n,e,t){return Ba(Fs(n),Hs(n,e),t.northeast(),oa(),"link-layout-ne")},js=function(n,e,t){return Ba(Bs(n,e),Hs(n,e),t.northwest(),ia(),"link-layout-nw")},Ls=[lr("item"),ns(),Au("placement",function(n,e,t){var r=ya(t,e.item.element()),o=es(n.element(),e,[Is,Ps,Vs,js],[Ps,Is,js,Vs]);return A.some($a({anchorBox:r,bubble:Fa(),overrides:{},layouts:o,placer:A.none()}))})],Us=ar("anchor",{selection:Ns,node:As,hotspot:ts,submenu:Ls,makeshift:rs}),Ws=function(n,e,t,r,o){var i,u=(i=t.anchorBox,_a(i,e));Ma(u,o.element(),t.bubble,t.layouts,r,t.overrides)},zs=function(e,n,t,r,o,i){var u=ur("positioning anchor.info",Us,r);Zi(o.element(),"position","fixed");var c=ru(o.element(),"visibility");Zi(o.element(),"visibility","hidden");var a,s,f,l=n.useFixed?Oa(0,0,b.window.innerWidth,b.window.innerHeight):(s=Hc((a=e).element()),f=a.element().dom().getBoundingClientRect(),wa(s.left(),s.top(),f.width,f.height)),d=u.placement,m=i.map(function(o){return function(){return e=Hc(n=o),t=Qc(n),r=Jc(n),da(e.left(),e.top(),t,r);var n,e,t,r}}).or(n.getBounds);d(e,u,l).each(function(n){n.placer.getOr(Ws)(e,l,n,m,o)}),c.fold(function(){ou(o.element(),"visibility")},function(n){Zi(o.element(),"visibility",n)}),ru(o.element(),"left").isNone()&&ru(o.element(),"top").isNone()&&ru(o.element(),"right").isNone()&&ru(o.element(),"bottom").isNone()&&ru(o.element(),"position").is("fixed")&&ou(o.element(),"position")},Gs=Object.freeze({position:function(n,e,t,r,o){var i=A.none();zs(n,e,t,r,o,i)},positionWithin:zs,getMode:function(n,e,t){return e.useFixed?"fixed":"absolute"}}),qs=[hr("useFixed",!1),gr("getBounds")],Ys=No({fields:qs,name:"positioning",active:Nc,apis:Gs}),Ks=function(n,e,t,r){var o=n.getSystem().build(r);Ec(n,o,t)},Xs=function(n,e,t,r){var o=Qs(n,e);q(o,function(n){return $n(r.element(),n.element())}).each(Cc)},Qs=function(n,e){return n.components()},$s=function(e,t,n,o,r){var i=Qs(e,t);return A.from(i[o]).map(function(n){return Xs(e,t,0,n),r.each(function(n){Ks(e,0,function(n,e){var t,r;r=e,te(t=n,o).fold(function(){ue(t,r)},function(n){oe(n,r)})},n)}),n})},Js=No({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,r){Ks(n,0,ue,r)},prepend:function(n,e,t,r){Ks(n,0,ie,r)},remove:Xs,replaceAt:$s,replaceBy:function(e,t,n,r,o){var i=Qs(e,t);return Y(i,r).bind(function(n){return $s(e,t,0,n,o)})},set:function(e,n,t,r){var o,i,u,c;Tc(e),o=function(){var n=j(r,e.getSystem().build);L(n,function(n){Sc(e,n)})},i=e.element(),u=Jn(i),c=Ro(u).bind(function(e){var n=function(n){return $n(e,n)};return n(i)?A.some(i):fo(i,n)}),o(i),c.each(function(e){Ro(u).filter(function(n){return $n(n,e)}).fold(function(){Ho(e)},y)})},contents:Qs})}),Zs=function(n){var e,t=n.dom();return!((e=t).offsetWidth<=0&&e.offsetHeight<=0)},nf=Object.freeze({getCurrent:function(n,e,t){return e.find(n)}}),ef=[lr("find")],tf=No({fields:ef,name:"composing",apis:nf}),rf=function(n,e){e.ignore||(Ho(n.element()),e.onFocus(n))},of=Object.freeze({focus:rf,blur:function(n,e){e.ignore||n.element().dom().blur()},isFocused:function(n){return e=n.element(),t=Jn(e).dom(),e.dom()===t.activeElement;var e,t}}),uf=Object.freeze({exhibit:function(n,e){var t=e.ignore?{}:{attributes:{tabindex:"-1"}};return xo(t)},events:function(t){return mo([go(Rr(),function(n,e){rf(n,t),e.stop()})].concat(t.stopMousedown?[go(Tr(),function(n,e){e.event().prevent()})]:[]))}}),cf=[Tu("onFocus"),hr("stopMousedown",!1),hr("ignore",!1)],af=No({fields:cf,name:"focusing",active:uf,apis:of}),sf=function(n,e,t){e.store.manager.onLoad(n,e,t)},ff=function(n,e,t){e.store.manager.onUnload(n,e,t)},lf=Object.freeze({onLoad:sf,onUnload:ff,setValue:function(n,e,t,r){e.store.manager.setValue(n,e,t,r)},getValue:function(n,e,t){return e.store.manager.getValue(n,e,t)},getState:function(n,e,t){return t}}),df=Object.freeze({events:function(t,r){var n=t.resetOnDom?[ho(function(n,e){sf(n,t,r)}),bo(function(n,e){ff(n,t,r)})]:[So(t,r,sf)];return mo(n)}}),mf=function(){var n=ce(null);return Or({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},gf=function(){var i=ce({}),u=ce({});return Or({readState:function(){return{mode:"dataset",dataByValue:i.get(),dataByText:u.get()}},lookup:function(n){return gt(i.get(),n).orThunk(function(){return gt(u.get(),n)})},update:function(n){var e=i.get(),t=u.get(),r={},o={};L(n,function(e){r[e.value]=e,gt(e,"meta").each(function(n){gt(n,"text").each(function(n){o[n]=e})})}),i.set(Ce({},e,r)),u.set(Ce({},t,o))},clear:function(){i.set({}),u.set({})}})},vf=Object.freeze({memory:mf,dataset:gf,manual:function(){return Or({readState:function(){}})},init:function(n){return n.store.manager.state(n)}}),pf=function(n,e,t,r){var o=e.store;t.update([r]),o.setValue(n,r),e.onSetValue(n,r)},hf=[gr("initialValue"),lr("getFallbackEntry"),lr("getDataKey"),lr("setValue"),Au("manager",{setValue:pf,getValue:function(n,e,t){var r=e.store,o=r.getDataKey(n);return t.lookup(o).fold(function(){return r.getFallbackEntry(o)},function(n){return n})},onLoad:function(e,t,r){t.store.initialValue.each(function(n){pf(e,t,r,n)})},onUnload:function(n,e,t){t.clear()},state:gf})],bf=[lr("getValue"),hr("setValue",y),gr("initialValue"),Au("manager",{setValue:function(n,e,t,r){e.store.setValue(n,r),e.onSetValue(n,r)},getValue:function(n,e,t){return e.store.getValue(n)},onLoad:function(e,t,n){t.store.initialValue.each(function(n){t.store.setValue(e,n)})},onUnload:y,state:wr.init})],yf=[gr("initialValue"),Au("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store.initialValue.each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:mf})],wf=[br("store",{mode:"memory"},ar("mode",{memory:yf,manual:bf,dataset:hf})),Tu("onSetValue"),hr("resetOnDom",!1)],Of=No({fields:wf,name:"representing",active:df,apis:lf,extra:{setValueFrom:function(n,e){var t=Of.getValue(e);Of.setValue(n,t)}},state:vf}),_f=Object.freeze({exhibit:function(n,e){return xo({attributes:pt([{key:e.tabAttr,value:"true"}])})}}),xf=[hr("tabAttr","data-alloy-tabstop")],Sf=No({fields:xf,name:"tabstopping",active:_f}),Ef=function(n,e,t,r){return gt(e.routes,r.start).bind(function(n){return gt(n,r.destination)})},kf=function(n,e,t,r){return Ef(0,e,0,r).bind(function(e){return e.transition.map(function(n){return{transition:n,route:e}})})},Cf=function(t,r,n){var e,o,i;(e=t,o=r,i=n,Tf(e,o,i).bind(function(n){return kf(e,o,i,n)})).each(function(n){var e=n.transition;ze(t.element(),e.transitionClass),_e(t.element(),r.destinationAttr)})},Tf=function(n,e,t){var r=n.element();return Oe(r,e.destinationAttr)?A.some({start:we(n.element(),e.stateAttr),destination:we(n.element(),e.destinationAttr)}):A.none()},Df=function(n,e,t,r){Cf(n,e,t),Oe(n.element(),e.stateAttr)&&we(n.element(),e.stateAttr)!==r&&e.onFinish(n,r),be(n.element(),e.stateAttr,r)},Mf=Object.freeze({findRoute:Ef,disableTransition:Cf,getCurrentRoute:Tf,jumpTo:Df,progressTo:function(t,r,o,i){var n,e;e=r,Oe((n=t).element(),e.destinationAttr)&&(be(n.element(),e.stateAttr,we(n.element(),e.destinationAttr)),_e(n.element(),e.destinationAttr));var u,c,a=(u=r,c=i,{start:we(t.element(),u.stateAttr),destination:c});kf(t,r,o,a).fold(function(){Df(t,r,o,i)},function(n){Cf(t,r,o);var e=n.transition;Ue(t.element(),e.transitionClass),be(t.element(),r.destinationAttr,i)})},getState:function(n,e,t){var r=n.element();return Oe(r,e.stateAttr)?A.some(we(r,e.stateAttr)):A.none()}}),Nf=Object.freeze({events:function(o,i){return mo([go(Br(),function(t,n){var r=n.event().raw();Tf(t,o,i).each(function(e){Ef(0,o,0,e).each(function(n){n.transition.each(function(n){r.propertyName===n.property&&(Df(t,o,i,e.destination),o.onTransition(t,e))})})})}),ho(function(n,e){Df(n,o,i,o.initialState)})])}}),Af=[hr("destinationAttr","data-transitioning-destination"),hr("stateAttr","data-transitioning-state"),lr("initialState"),Tu("onTransition"),Tu("onFinish"),dr("routes",rr(Fe.value,rr(Fe.value,Yt([pr("transition",[lr("property"),lr("transitionClass")])]))))],Ff=No({fields:Af,name:"transitioning",active:Nf,apis:Mf,extra:{createRoutes:function(n){var r={};return cn(n,function(n,e){var t=e.split("<->");r[t[0]]=vt(t[1],n),r[t[1]]=vt(t[0],n)}),r},createBistate:function(n,e,t){return pt([{key:n,value:vt(e,t)},{key:e,value:vt(n,t)}])},createTristate:function(n,e,t,r){return pt([{key:n,value:pt([{key:e,value:r},{key:t,value:r}])},{key:e,value:pt([{key:n,value:r},{key:t,value:r}])},{key:t,value:pt([{key:n,value:r},{key:e,value:r}])}])}}}),Bf=Wn.detect().os.isOSX()?"⌘":"Ctrl",Hf=an({tc_menu_name:"TinyComments",tc_announce_sidebar_available:"Comment. Sidebar available. Press "+Bf+" + Alt + M to switch to sidebar",tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_save:"Save",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Say something ...",tc_kebab_deleteconversation:"Delete conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the Console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_create_problem:"An error occurred while creating a comment. See the Console for details",tc_reply_problem:"An error occurred while replying to a comment. See the Console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_delete_problem_all:"An error occurred deleting all the conversations. See the Console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the Console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the Console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},s),Rf=function(n,e,t){var r=e.aria;r.update(n,r,t.get())},If=function(e,n,t){n.toggleClass.each(function(n){t.get()?Ue(e.element(),n):ze(e.element(),n)})},Pf=function(n,e,t){Lf(n,e,t,!t.get())},Vf=function(n,e,t){t.set(!0),If(n,e,t),Rf(n,e,t)},jf=function(n,e,t){t.set(!1),If(n,e,t),Rf(n,e,t)},Lf=function(n,e,t,r){(r?Vf:jf)(n,e,t)},Uf=function(n,e,t){Lf(n,e,t,e.selected)},Wf=Object.freeze({onLoad:Uf,toggle:Pf,isOn:function(n,e,t){return t.get()},on:Vf,off:jf,set:Lf}),zf=Object.freeze({exhibit:function(n,e,t){return xo({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=Pf,wo(function(n){o(n,t,r)})),u=So(n,e,Uf);return mo(Q([n.toggleOnExecute?[i]:[],[u]]))}}),Gf=Object.freeze({init:function(n){var e=ce(!1);return{readState:function(){return e.get()},get:function(){return e.get()},set:function(n){return e.set(n)},clear:function(){return e.set(!1)}}}}),qf=function(n,e,t){be(n.element(),"aria-expanded",t)},Yf=[hr("selected",!1),gr("toggleClass"),hr("toggleOnExecute",!0),br("aria",{mode:"none"},ar("mode",{pressed:[hr("syncWithExpanded",!1),Au("update",function(n,e,t){be(n.element(),"aria-pressed",t),e.syncWithExpanded&&qf(n,e,t)})],checked:[Au("update",function(n,e,t){be(n.element(),"aria-checked",t)})],expanded:[Au("update",qf)],selected:[Au("update",function(n,e,t){be(n.element(),"aria-selected",t)})],none:[Au("update",y)]}))],Kf=No({fields:Yf,name:"toggling",active:zf,apis:Wf,state:Gf}),Xf=function(n){var e=function(n,e){e.stop(),eo(n)},t=Wn.detect().deviceType.isTouch()?[go(Ur(),e)]:[go(Fr(),e),go(Tr(),function(n,e){e.cut()})];return mo(Q([n.map(function(t){return go(jr(),function(n,e){t(n),e.stop()})}).toArray(),t]))},Qf=function(n,e,t){var r=nn(n.slice(0,e)),o=nn(n.slice(e+1));return q(r.concat(o),t)},$f=function(n,e,t){var r=nn(n.slice(0,e));return q(r,t)},Jf=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return q(o.concat(r),t)},Zf=function(n,e,t){var r=n.slice(e+1);return q(r,t)},nl=function(t){return function(n){var e=n.raw();return P(t,e.which)}},el=function(n){return function(e){return J(n,function(n){return n(e)})}},tl=function(n){return!0===n.raw().shiftKey},rl=function(n){return!0===n.raw().ctrlKey},ol=(qc=tl,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!qc.apply(null,n)}),il=function(n,e){return{matches:n,classification:e}},ul=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},cl=function(n,e,t){return n<=e?e:t<=n?t:n},al=function(t,r,n,o){var e=qe(t.element(),"."+r.highlightClass);L(e,function(e){V(o,function(n){return n.element()===e})||(ze(e,r.highlightClass),t.getSystem().getByDom(e).each(function(n){r.onDehighlight(t,n),Zr(n,Jr())}))})},sl=function(n,e,t,r){al(n,e,0,[r]),fl(n,e,t,r)||(Ue(r.element(),e.highlightClass),e.onHighlight(n,r),Zr(r,$r()))},fl=function(n,e,t,r){return Ge(r.element(),e.highlightClass)},ll=function(n,e,t,r){var o=qe(n.element(),"."+e.itemClass);return A.from(o[r]).fold(function(){return Fe.error("No element found with index "+r)},n.getSystem().getByDom)},dl=function(e,n,t){return oi(e.element(),"."+n.itemClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},ml=function(e,n,t){var r=qe(e.element(),"."+n.itemClass);return(0<r.length?A.some(r[r.length-1]):A.none()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},gl=function(t,e,n,r){var o=qe(t.element(),"."+e.itemClass);return Y(o,function(n){return Ge(n,e.highlightClass)}).bind(function(n){var e=ul(n,r,0,o.length-1);return t.getSystem().getByDom(o[e]).toOption()})},vl=function(e,n,t){var r=qe(e.element(),"."+n.itemClass);return Lo(j(r,function(n){return e.getSystem().getByDom(n).toOption()}))},pl=Object.freeze({dehighlightAll:function(n,e,t){return al(n,e,0,[])},dehighlight:function(n,e,t,r){fl(n,e,t,r)&&(ze(r.element(),e.highlightClass),e.onDehighlight(n,r),Zr(r,Jr()))},highlight:sl,highlightFirst:function(e,t,r){dl(e,t,r).each(function(n){sl(e,t,r,n)})},highlightLast:function(e,t,r){ml(e,t,r).each(function(n){sl(e,t,r,n)})},highlightAt:function(e,t,r,n){ll(e,t,r,n).fold(function(n){throw new Error(n)},function(n){sl(e,t,r,n)})},highlightBy:function(e,t,r,n){var o=vl(e,t,r);q(o,n).each(function(n){sl(e,t,r,n)})},isHighlighted:fl,getHighlighted:function(e,n,t){return oi(e.element(),"."+n.highlightClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},getFirst:dl,getLast:ml,getPrevious:function(n,e,t){return gl(n,e,0,-1)},getNext:function(n,e,t){return gl(n,e,0,1)},getCandidates:vl}),hl=[lr("highlightClass"),lr("itemClass"),Tu("onHighlight"),Tu("onDehighlight")],bl=No({fields:hl,name:"highlighting",apis:pl}),yl=function(n,e,t){e.exists(function(e){return t.exists(function(n){return $n(n,e)})})||no(n,Qr(),{prevFocus:e,newFocus:t})},wl=function(){var o=function(n){return Io(n.element())};return{get:o,set:function(n,e){var t=o(n);n.getSystem().triggerFocus(e,n.element());var r=o(n);yl(n,t,r)}}};(Kc=Yc||(Yc={})).OnFocusMode="onFocus",Kc.OnEnterOrSpaceMode="onEnterOrSpace",Kc.OnApiMode="onApi";var Ol,_l,xl,Sl,El,kl,Cl=function(n,e,t,r,c){var a=function(e,t,n,r,o){var i,u,c=n(e,t,r,o);return(i=c,u=t.event(),q(i,function(n){return n.matches(u)}).map(function(n){return n.classification})).bind(function(n){return n(e,t,r,o)})},o={schema:function(){return n.concat([hr("focusManager",wl()),br("focusInside","onFocus",tr(function(n){return P(["onFocus","onEnterOrSpace","onApi"],n)?Fe.value(n):Fe.error("Invalid value for focusInside")})),Au("handler",o),Au("state",e),Au("sendFocusIn",c)])},processKey:a,toEvents:function(i,u){var n=i.focusInside!==Yc.OnFocusMode?A.none():c(i).map(function(t){return go(Rr(),function(n,e){t(n,i,u),e.stop()})});return mo(n.toArray().concat([go(Mr(),function(r,o){a(r,o,t,i,u).fold(function(){var e,t,n;e=r,t=o,n=nl([32].concat([13]))(t.event()),i.focusInside===Yc.OnEnterOrSpaceMode&&n&&_r(e,t)&&c(i).each(function(n){n(e,i,u),t.stop()})},function(n){o.stop()})}),go(Nr(),function(n,e){a(n,e,r,i,u).each(function(n){e.stop()})})]))}};return o},Tl=function(n){var e=[gr("onEscape"),gr("onEnter"),hr("selector",'[data-alloy-tabstop="true"]'),hr("firstTabstop",0),hr("useTabstopAt",W(!0)),gr("visibilitySelector")].concat([n]),u=function(n,e){var t,r=n.visibilitySelector.bind(function(n){return ii(e,n)}).getOr(e);return t=r,0<$c.get(t)},t=function(e,t){var n,r,o,i;(n=e,r=t,o=qe(n.element(),r.selector),i=U(o,function(n){return u(r,n)}),A.from(i[r.firstTabstop])).each(function(n){t.focusManager.set(e,n)})},c=function(e,n,t,r,o){return o(n,t,function(n){return u(e=r,t=n)&&e.useTabstopAt(t);var e,t}).fold(function(){return r.cyclic?A.some(!0):A.none()},function(n){return r.focusManager.set(e,n),A.some(!0)})},i=function(e,n,t,r){var o,i,u=qe(e.element(),t.selector);return(o=e,i=t,i.focusManager.get(o).bind(function(n){return ii(n,i.selector)})).bind(function(n){return Y(u,l($n,n)).bind(function(n){return c(e,u,n,t,r)})})},r=W([il(el([tl,nl([9])]),function(n,e,t,r){var o=t.cyclic?Qf:$f;return i(n,0,t,o)}),il(nl([9]),function(n,e,t,r){var o=t.cyclic?Jf:Zf;return i(n,0,t,o)}),il(nl([27]),function(e,t,n,r){return n.onEscape.bind(function(n){return n(e,t)})}),il(el([ol,nl([13])]),function(e,t,n,r){return n.onEnter.bind(function(n){return n(e,t)})})]),o=W([]);return Cl(e,wr.init,r,o,function(){return A.some(t)})},Dl=Tl(yr("cyclic",W(!1))),Ml=Tl(yr("cyclic",W(!0))),Nl=function(n){return"input"===de(n)&&"radio"!==we(n,"type")||"textarea"===de(n)},Al=function(n,e,t){return Nl(t)&&nl([32])(e.event())?A.none():(to(n,t,jr()),A.some(!0))},Fl=function(n,e){return A.some(!0)},Bl=[hr("execute",Al),hr("useSpace",!1),hr("useEnter",!0),hr("useControlEnter",!1),hr("useDown",!1)],Hl=function(n,e,t){return t.execute(n,e,n.element())},Rl=Cl(Bl,wr.init,function(n,e,t,r){var o=t.useSpace&&!Nl(n.element())?[32]:[],i=t.useEnter?[13]:[],u=t.useDown?[40]:[],c=o.concat(i).concat(u);return[il(nl(c),Hl)].concat(t.useControlEnter?[il(el([rl,nl([13])]),Hl)]:[])},function(n,e,t,r){return t.useSpace&&!Nl(n.element())?[il(nl([32]),Fl)]:[]},function(){return A.none()}),Il=function(n){var t=ce(A.none());return Or({readState:function(){return t.get().map(function(n){return{numRows:n.numRows(),numColumns:n.numColumns()}}).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(n,e){t.set(A.some({numRows:W(n),numColumns:W(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},Pl=Object.freeze({flatgrid:Il,init:function(n){return n.state(n)}}),Vl=function(i){return function(n,e,t,r){var o=i(n.element());return Wl(o,n,e,t,r)}},jl=function(n,e){var t=Ja(n,e);return Vl(t)},Ll=function(n,e){var t=Ja(e,n);return Vl(t)},Ul=function(o){return function(n,e,t,r){return Wl(o,n,e,t,r)}},Wl=function(e,t,n,r,o){return r.focusManager.get(t).bind(function(n){return e(t.element(),n,r,o)}).map(function(n){return r.focusManager.set(t,n),!0})},zl=Ul,Gl=Ul,ql=Ul,Yl=gn(["index","candidates"],[]),Kl=function(n,e,t){return Xl(n,e,t,Zs)},Xl=function(n,e,t,r){var o,i=l($n,e),u=qe(n,t),c=U(u,Zs);return Y(o=c,i).map(function(n){return Yl({index:n,candidates:o})})},Ql=function(n,e){return Y(n,function(n){return $n(e,n)})},$l=function(t,n,r,e){return e(Math.floor(n/r),n%r).bind(function(n){var e=n.row()*r+n.column();return 0<=e&&e<t.length?A.some(t[e]):A.none()})},Jl=function(o,n,i,u,c){return $l(o,n,u,function(n,e){var t=n===i-1?o.length-n*u:u,r=ul(e,c,0,t-1);return A.some({row:W(n),column:W(r)})})},Zl=function(i,n,u,c,a){return $l(i,n,c,function(n,e){var t=ul(n,a,0,u-1),r=t===u-1?i.length-t*c:c,o=cl(e,0,r-1);return A.some({row:W(t),column:W(o)})})},nd=[lr("selector"),hr("execute",Al),Du("onEscape"),hr("captureTab",!1),Bu()],ed=function(e,t,n){oi(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},td=function(o){return function(n,e,t,r){return Kl(n,e,t.selector).bind(function(n){return o(n.candidates(),n.index(),r.getNumRows().getOr(t.initSize.numRows),r.getNumColumns().getOr(t.initSize.numColumns))})}},rd=function(n,e,t,r){return t.captureTab?A.some(!0):A.none()},od=td(function(n,e,t,r){return Jl(n,e,t,r,-1)}),id=td(function(n,e,t,r){return Jl(n,e,t,r,1)}),ud=td(function(n,e,t,r){return Zl(n,e,t,r,-1)}),cd=td(function(n,e,t,r){return Zl(n,e,t,r,1)}),ad=W([il(nl([37]),jl(od,id)),il(nl([39]),Ll(od,id)),il(nl([38]),zl(ud)),il(nl([40]),Gl(cd)),il(el([tl,nl([9])]),rd),il(el([ol,nl([9])]),rd),il(nl([27]),function(n,e,t,r){return t.onEscape(n,e)}),il(nl([32].concat([13])),function(e,t,r,n){return(o=e,i=r,i.focusManager.get(o).bind(function(n){return ii(n,i.selector)})).bind(function(n){return r.execute(e,t,n)});var o,i})]),sd=W([il(nl([32]),Fl)]),fd=Cl(nd,Il,ad,sd,function(){return A.some(ed)}),ld=function(n,e,t,i){var u=function(n,e,t){var r,o=ul(e,i,0,t.length-1);return o===n?A.none():(r=t[o],"button"===de(r)&&"disabled"===we(r,"disabled")?u(n,o,t):A.from(t[o]))};return Kl(n,t,e).bind(function(n){var e=n.index(),t=n.candidates();return u(e,e,t)})},dd=[lr("selector"),hr("getInitial",A.none),hr("execute",Al),Du("onEscape"),hr("executeOnMove",!1),hr("allowVertical",!0)],md=function(e,t,r){return(n=e,o=r,o.focusManager.get(n).bind(function(n){return ii(n,o.selector)})).bind(function(n){return r.execute(e,t,n)});var n,o},gd=function(e,t){t.getInitial(e).orThunk(function(){return oi(e.element(),t.selector)}).each(function(n){t.focusManager.set(e,n)})},vd=function(n,e,t){return ld(n,t.selector,e,-1)},pd=function(n,e,t){return ld(n,t.selector,e,1)},hd=function(r){return function(n,e,t){return r(n,e,t).bind(function(){return t.executeOnMove?md(n,e,t):A.some(!0)})}},bd=function(n,e,t,r){return t.onEscape(n,e)},yd=W([il(nl([32]),Fl)]),wd=Cl(dd,wr.init,function(n,e,t,r){var o=[37].concat(t.allowVertical?[38]:[]),i=[39].concat(t.allowVertical?[40]:[]);return[il(nl(o),hd(jl(vd,pd))),il(nl(i),hd(Ll(vd,pd))),il(nl([13]),md),il(nl([32]),md),il(nl([27]),bd)]},yd,function(){return A.some(gd)}),Od=gn(["rowIndex","columnIndex","cell"],[]),_d=function(n,e,t){return A.from(n[e]).bind(function(n){return A.from(n[t]).map(function(n){return Od({rowIndex:e,columnIndex:t,cell:n})})})},xd=function(n,e,t,r){var o=n[e].length,i=ul(t,r,0,o-1);return _d(n,e,i)},Sd=function(n,e,t,r){var o=ul(t,r,0,n.length-1),i=n[o].length,u=cl(e,0,i-1);return _d(n,o,u)},Ed=function(n,e,t,r){var o=n[e].length,i=cl(t+r,0,o-1);return _d(n,e,i)},kd=function(n,e,t,r){var o=cl(t+r,0,n.length-1),i=n[o].length,u=cl(e,0,i-1);return _d(n,o,u)},Cd=[mr("selectors",[lr("row"),lr("cell")]),hr("cycles",!0),hr("previousSelector",A.none),hr("execute",Al)],Td=function(e,t){t.previousSelector(e).orThunk(function(){var n=t.selectors;return oi(e.element(),n.cell)}).each(function(n){t.focusManager.set(e,n)})},Dd=function(n,e){return function(t,r,i){var u=i.cycles?n:e;return ii(r,i.selectors.row).bind(function(n){var e=qe(n,i.selectors.cell);return Ql(e,r).bind(function(r){var o=qe(t,i.selectors.row);return Ql(o,n).bind(function(n){var e,t=(e=i,j(o,function(n){return qe(n,e.selectors.cell)}));return u(t,n,r).map(function(n){return n.cell()})})})})}},Md=Dd(function(n,e,t){return xd(n,e,t,-1)},function(n,e,t){return Ed(n,e,t,-1)}),Nd=Dd(function(n,e,t){return xd(n,e,t,1)},function(n,e,t){return Ed(n,e,t,1)}),Ad=Dd(function(n,e,t){return Sd(n,t,e,-1)},function(n,e,t){return kd(n,t,e,-1)}),Fd=Dd(function(n,e,t){return Sd(n,t,e,1)},function(n,e,t){return kd(n,t,e,1)}),Bd=W([il(nl([37]),jl(Md,Nd)),il(nl([39]),Ll(Md,Nd)),il(nl([38]),zl(Ad)),il(nl([40]),Gl(Fd)),il(nl([32].concat([13])),function(e,t,r){return Io(e.element()).bind(function(n){return r.execute(e,t,n)})})]),Hd=W([il(nl([32]),Fl)]),Rd=Cl(Cd,wr.init,Bd,Hd,function(){return A.some(Td)}),Id=[lr("selector"),hr("execute",Al),hr("moveOnTab",!1)],Pd=function(e,t,r){return r.focusManager.get(e).bind(function(n){return r.execute(e,t,n)})},Vd=function(e,t){oi(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},jd=function(n,e,t){return ld(n,t.selector,e,-1)},Ld=function(n,e,t){return ld(n,t.selector,e,1)},Ud=W([il(nl([38]),ql(jd)),il(nl([40]),ql(Ld)),il(el([tl,nl([9])]),function(n,e,t){return t.moveOnTab?ql(jd)(n,e,t):A.none()}),il(el([ol,nl([9])]),function(n,e,t){return t.moveOnTab?ql(Ld)(n,e,t):A.none()}),il(nl([13]),Pd),il(nl([32]),Pd)]),Wd=W([il(nl([32]),Fl)]),zd=Cl(Id,wr.init,Ud,Wd,function(){return A.some(Vd)}),Gd=[Du("onSpace"),Du("onEnter"),Du("onShiftEnter"),Du("onLeft"),Du("onRight"),Du("onTab"),Du("onShiftTab"),Du("onUp"),Du("onDown"),Du("onEscape"),hr("stopSpaceKeyup",!1),gr("focusIn")],qd=Cl(Gd,wr.init,function(n,e,t){return[il(nl([32]),t.onSpace),il(el([ol,nl([13])]),t.onEnter),il(el([tl,nl([13])]),t.onShiftEnter),il(el([tl,nl([9])]),t.onShiftTab),il(el([ol,nl([9])]),t.onTab),il(nl([38]),t.onUp),il(nl([40]),t.onDown),il(nl([37]),t.onLeft),il(nl([39]),t.onRight),il(nl([32]),t.onSpace),il(nl([27]),t.onEscape)]},function(n,e,t){return t.stopSpaceKeyup?[il(nl([32]),Fl)]:[]},function(n){return n.focusIn}),Yd=Dl.schema(),Kd=Ml.schema(),Xd=wd.schema(),Qd=fd.schema(),$d=Rd.schema(),Jd=Rl.schema(),Zd=zd.schema(),nm=qd.schema(),em=(_l=ur("Creating behaviour: "+(Ol={branchKey:"mode",branches:Object.freeze({acyclic:Yd,cyclic:Kd,flow:Xd,flatgrid:Qd,matrix:$d,execution:Jd,menu:Zd,special:nm}),name:"keying",active:{events:function(n,e){return n.handler.toEvents(n,e)}},apis:{focusIn:function(e,t,r){t.sendFocusIn(t).fold(function(){e.getSystem().triggerFocus(e.element(),e.element())},function(n){n(e,t,r)})},setGridSize:function(n,e,t,r,o){bt(t,"setGridSize")?t.setGridSize(r,o):b.console.error("Layout does not support setGridSize")}},state:Pl}).name,Ao,Ol),Eo(ar(_l.branchKey,_l.branches),_l.name,_l.active,_l.apis,_l.extra,_l.state)),tm=wc({name:"Button",factory:function(n){var e=Xf(n.action),t=n.dom.tag,r=function(e){return gt(n.dom,"attributes").bind(function(n){return gt(n,e)})};return{uid:n.uid,dom:n.dom,components:n.components,events:e,behaviours:Ou(n.buttonBehaviours,[af.config({}),em.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"!==t)return{role:r("role").getOr("button")};var n=r("type").getOr("button"),e=r("role").map(function(n){return{role:n}}).getOr({});return Ce({type:n},e)}()},eventOrder:n.eventOrder}},configFields:[hr("uid",void 0),lr("dom"),hr("components",[]),wu("buttonBehaviours",[af,em]),gr("action"),gr("role"),hr("eventOrder",{})]}),rm="tox-button--naked",om="tox-comment",im="tox-comment__body",um="tox-textarea",cm="tox-comment__reply",am="tox-comment__overlay",sm="tox-comment__overlaytext",fm="tox-comment__buttonspacing",lm="tox-button",dm="tox-comment__edit",mm="tox-comment__scroll",gm="tox-collection__item",vm="tox-conversations",pm="tox-comment__expander",hm=pm+" p:contains("+Hf.tc_comment_buttons_showmore+")",bm=pm+" p:contains("+Hf.tc_comment_buttons_showless+")",ym=function(n){return"."+n},wm=function(e){return function(n){return[ym(om)+":contains("+n+")",ym(e)].join(" ")}},Om={selectors:{kebab:ym(rm),cardBody:ym(om)+" "+ym(im),card:ym(om),showMore:ym(hm),showLess:ym(bm),editItem:[".tox-menu",'[role="menuitem"]:contains('+Hf.tc_kebab_edit+")"].join(" "),deleteItem:[".tox-menu",'[role="menuitem"]:contains('+Hf.tc_kebab_delete+")"].join(" "),outerScroll:ym(mm),outerContainer:ym(vm),cardFor:function(n){return ym(om)+':contains("'+n+'")'},cardN:function(n){return ym(om)+":nth-child("+(n+1)+")"},kebabFor:wm(rm),showMoreFor:wm(hm),showLessFor:wm(bm),saveButton:".tox-button:contains("+Hf.tc_edit_buttons_save+")",cancelButton:".tox-button:contains("+Hf.tc_edit_buttons_cancel+")",deleteButton:".tox-button:contains("+Hf.tc_delete_buttons_proceed+")",commentText:[ym(vm),ym(mm),ym(om),"textarea"].join(" "),editActions:ym(dm),cardDeleteButtons:ym(fm),cardDeleteOverlay:ym(am),cardDeleteOverlayText:ym(sm),replyTextarea:"."+cm+" textarea",editTextarea:[ym(om),"textarea"].join(" "),kebabMenu:ym("tox-menu"),textarea:ym(um)},states:{kebabOpen:rm+"--open",bodyExpanded:"tox-comment__body--expanded",bodyNotAnimating:"tox-comment__body--pending",disappearing:"tox-comment--disappearing",deletingConversation:"tox-comment-thread__overlay",bodyHasGradient:"tox-comment__gradient",editingTextarea:um},classes:{showMoreLessContainer:[pm],outerContainer:[vm],date:["tox-comment__date"],replySection:[cm],replyTextarea:[um],textarea:[],editTextarea:[],kebab:[rm,lm,"tox-button--icon"],kebabIcon:["tox-icon"],card:[om],cardHead:["tox-comment__header"],cardHeadMeta:["tox-comment__meta"],cardBody:[im],cardDelete:[am],cardDeleteLabel:[sm],cardDeleteButtons:[fm],button:[lm],secondaryButton:[lm,"tox-button--secondary"],editActions:[dm],outerScroll:[mm],commentList:["tox-comment-thread"],avatar:["tox-user__avatar"],username:["tox-user__name"],user:["tox-user"],showMoreLess:[],kebabItem:[gm],kebabItemLabel:["tox-collection__item-label"],kebabMenu:["tox-menu","tox-collection","tox-collection--list"],kebabMenuGroup:["tox-collection__group"],roots:{silver:[vm],modern:[vm,"tox"]}},markers:{kebab:{backgroundMenu:"tox-menu--background",selectedMenu:"tox-menu--active",menu:"tox-menu",item:gm,selectedItem:"tox-collection__item--active"}}},_m=function(t){return function(n){var e=n.eventName.map(function(e){return{action:function(n){Zr(n,e)}}}).getOr({});return tm.sketch(Ce({dom:{tag:"button",classes:t,styles:void 0!==n.styles?n.styles:{},innerHtml:n.text}},e,{buttonBehaviours:Do([Sf.config({})])}))}},xm=_m(Om.classes.button),Sm=_m(Om.classes.secondaryButton),Em={withClasses:_m,primary:xm,secondary:Sm},km="tc-save-edit",Cm="tc-cancel-edit",Tm=yi("tc-patch-comment-state-event"),Dm=yi("tc-purge-comment-state-event"),Mm=yi("tc-force-patch-state-event");(Sl=xl||(xl={})).None="Prop_None",Sl.Collapsed="Prop_Collapsed",Sl.Expanded="Prop_Expanded",Sl.CollapsedOrNone="Prop_CollapsedOrNone",Sl.ExpandOrNone="Prop_ExpandOrNone",Sl.Edit="Prop_Edit",(kl=El||(El={}))[kl.BeforeDelete=0]="BeforeDelete",kl[kl.QueryingDelete=1]="QueryingDelete",kl[kl.PostDelete=2]="PostDelete";var Nm,Am,Fm=function(n){return j(n.conversation,function(n){return n.props})},Bm=function(n,e){return Ce({},n,{targetUid:e})},Hm=function(n,e){return Ce({},n,{queue:n.queue.concat(e)})},Rm=function(n){if(0<n.queue.length){var e=(t=j((r=n).conversation,function(t){return q(r.queue,function(n){return n.uid===t.uid}).fold(function(){return t},function(n){var e=void 0!==n.patch.content?{mode:xl.ExpandOrNone}:{};return{uid:t.uid,props:Ce({},t.props,n.patch,e)}})}),{targetUid:r.targetUid,conversation:t,queue:[]});return A.some({world:e,props:Fm(e)})}return A.none();var r,t},Im=function(){return{targetUid:A.none(),conversation:[],queue:[]}},Pm=function(t,r){return function(n){var e=r(n);no(n,Tm,{uid:t,patch:e})}},Vm=function(t,r){return function(n){var e=r(n);no(n,Tm,{uid:t,patch:e}),Zr(n,Mm)}},jm=function(n){return Zr(n,Mm)},Lm=function(n,e){Zi(n.element(),"visibility","hidden"),Kf.set(n,!1);var t=n.element().dom().clientHeight;return Kf.set(n,!0),ou(n.element(),"visibility"),n.element().dom().scrollHeight>t+1?e:xl.None},Um=function(n){Kf.off(n),Ue(n.element(),Om.states.bodyHasGradient)},Wm=function(n){Kf.on(n),ze(n.element(),Om.states.bodyHasGradient)},zm=function(n){return re(n.element())},Gm=function(n,e){Ym(n),e.getOpt(n).fold(function(){Js.append(n,e.asSpec())},function(){})},qm=function(n){ze(n.element(),Om.states.bodyHasGradient),Kf.set(n,!1),_e(n.element(),"aria-expanded")},Ym=function(n){zm(n).each(function(n){_e(n,"readonly"),Ue(n,Om.states.editingTextarea),Ho(n);var e=n.dom(),t=iu(n).length;e.setSelectionRange(t,t)}),n.element().dom().scrollTop=0},Km=function(n){zm(n).each(function(n){be(n,"readonly","true"),ze(n,Om.states.editingTextarea)})},Xm=function(r){var n,e=function(n){return function(e){L(n,function(n){return n(e)})}},t=function(e){zm(e).each(function(n){ou(n,"height"),Of.setValue(e,r.props.content),e.getSystem().triggerEvent(Ar(),n,{})})},o=function(n){return e=n,t=r.memCommands,Km(e),void t.getOpt(e).each(function(n){Js.remove(e,n)});var e,t},i=((n={})[xl.None]=e([o,t,qm]),n[xl.Expanded]=e([o,t,Wm]),n[xl.Collapsed]=e([o,t,Um]),n[xl.ExpandOrNone]=e([o,t,function(n){Ue(n.element(),Om.states.bodyNotAnimating);var e=Lm(n,xl.Expanded);Pm(r.props.uid,function(){return{mode:e}})(n)}]),n[xl.CollapsedOrNone]=e([o,t,function(n){Ue(n.element(),Om.states.bodyNotAnimating);var e=Lm(n,xl.Collapsed);e===xl.Collapsed&&(Ue(n.element(),Om.states.bodyHasGradient),Kf.off(n)),n.element().dom().offsetWidth,Pm(r.props.uid,function(){return{mode:e}})(n)}]),n[xl.Edit]=e([function(n){return e=n,t=r.memCommands,Kf.on(e),ze(e.element(),Om.states.bodyHasGradient),void Gm(e,t);var e,t},t]),n);return gt(i,r.props.mode)},Qm=yi("tc-focus-outer-comment"),$m=yi("tc-start-delete-comment"),Jm=yi("tc-start-delete-conversation"),Zm=yi("tc-commit-delete"),ng=yi("tc-start-edit-comment"),eg=yi("tc-commit-edit-comment"),tg=(yi("tc-cancel-edit-comment"),yi("tc-long-content"),yi("tc-short-content"),yi("tc-toggle-comment")),rg=W([gr("data"),hr("inputAttributes",{}),hr("inputStyles",{}),hr("tag","input"),hr("inputClasses",[]),Tu("onSetValue"),hr("styles",{}),hr("eventOrder",{}),hu("inputBehaviours",[Of,af]),hr("selectOnFocus",!0)]),og=function(n){return Ce({},(e=n,Do([af.config({onFocus:!1===e.selectOnFocus?y:function(n){var e=n.element(),t=iu(e);e.dom().setSelectionRange(0,t.length)}})])),yu(n.inputBehaviours,[Of.config({store:{mode:"manual",initialValue:n.data.getOr(void 0),getValue:function(n){return iu(n.element())},setValue:function(n,e){iu(n.element())!==e&&uu(n.element(),e)}},onSetValue:n.onSetValue})]));var e},ig=wc({name:"Input",configFields:rg(),factory:function(n,e){return{uid:n.uid,dom:(t=n,{tag:t.tag,attributes:Ce({type:"text"},t.inputAttributes),styles:t.inputStyles,classes:t.inputClasses}),components:[],behaviours:og(n),eventOrder:n.eventOrder};var t}}),ug="data-alloy-widget-tabstop",cg=function(n){return em.config({mode:"cyclic",onEscape:n.onEscape,useTabstopAt:function(n){return"textarea"!==de(n)||"true"!==we(n,"readonly")}})},ag=function(e){return em.config({mode:"special",onEnter:function(n){return Zr(n,e.enterEvent),A.some(!0)},onShiftEnter:function(n,e){return e.cut(),A.none()},onSpace:function(n,e){return e.cut(),A.none()}})},sg=function(t){return em.config({mode:"cyclic",selector:"["+ug+'="true"]',focusInside:Yc.OnEnterOrSpaceMode,onEscape:function(n,e){return _r(n,e)?A.none():(Zr(n,t.escapeEvent),A.some(!0))}})},fg=function(n){return em.config({mode:"flow",allowVertical:!0,selector:n.selector})},lg=ug,dg={"data-gramm_editor":"false",rows:"2"},mg={"white-space":"pre-wrap"},gg=function(n){var e=n.element().dom().clientHeight,t=n.element().dom().scrollHeight;e<t&&Zi(n.element(),"height",t+"px")},vg=function(n,e){var t,r,o=ce(n),i=function(n){Zr(n,Qm),Vm(o.get().uid,function(n){return{mode:xl.ExpandOrNone}})(n)},u={updateWith:function(e,n,t){o.set(n),Xm({props:n,memCommands:c}).each(function(n){ze(e.element(),Om.states.bodyNotAnimating),n(e)})}},c=Mc((o.get(),t=e,{dom:{tag:"div",classes:Om.classes.editActions},components:[Em.withClasses(Om.classes.secondaryButton)({text:t.translate(Hf.tc_edit_buttons_cancel),eventName:A.some(Cm)}),Em.withClasses(Om.classes.button)({text:t.translate(Hf.tc_edit_buttons_save),eventName:A.some(km)})]}));return{dom:{tag:"div",classes:Om.classes.cardBody},components:[(r=o.get().content,ig.sketch({tag:"textarea",inputAttributes:Ce({},dg,{readonly:"true"}),inputClasses:Om.classes.editTextarea,inputStyles:Ce({},mg,{"overflow-y":"hidden",border:"none !important"}),data:r,inputBehaviours:Do([Bo("textarea-events",[ho(function(n){gg(n)}),go(Ar(),gg)]),ag({enterEvent:eg}),Sf.config({})])}))],behaviours:Do([Bo("overflow-events",[ho(function(n){u.updateWith(n,o.get(),{})}),go(km,function(n){Zr(n,eg)}),go(Cm,i)]),cg({onEscape:function(n,e){return i(n),A.some(!0)}}),Kf.config({toggleClass:Om.states.bodyExpanded,selected:!1,toggleOnExecute:!1,aria:{mode:"expanded"}}),Of.config({store:{mode:"manual",getValue:function(n){return re(n.element()).map(iu).getOr("")},setValue:function(n,e){re(n.element()).each(function(n){uu(n,e)})}}}),Js.config({})]),apis:u}},pg=6048e5,hg=4*pg;(Am=Nm||(Nm={}))[Am.LessThanMinute=0]="LessThanMinute",Am[Am.Minute=1]="Minute",Am[Am.Hour=2]="Hour",Am[Am.Day=3]="Day",Am[Am.Week=4]="Week",Am[Am.Month=5]="Month",Am[Am.Year=6]="Year";var bg,yg,wg,Og=function(n,e){var t=n()-Date.parse(e);return t<6e4?{interval:Nm.LessThanMinute,intervalUnits:t,intervalMs:t}:t<36e5?{interval:Nm.Minute,intervalUnits:Math.floor(t/6e4),intervalMs:t}:t<864e5?{interval:Nm.Hour,intervalUnits:Math.floor(t/36e5),intervalMs:t}:t<pg?{interval:Nm.Day,intervalUnits:Math.floor(t/864e5),intervalMs:t}:t<hg?{interval:Nm.Week,intervalUnits:Math.floor(t/pg),intervalMs:t}:t<290304e5?{interval:Nm.Month,intervalUnits:Math.floor(t/hg),intervalMs:t}:{interval:Nm.Year,intervalUnits:Math.floor(t/290304e5),intervalMs:t}},_g={nowISO8601:function(){return(new Date).toISOString()},distanceFromNow:l(Og,function(){return Date.now()}),distanceFrom:Og},xg=((bg={})[Nm.LessThanMinute]=[Hf.tc_date_less_than_a_minute_ago,Hf.tc_date_less_than_a_minute_ago],bg[Nm.Minute]=[Hf.tc_date_1_minute_ago,Hf.tc_date_x_minutes_ago],bg[Nm.Hour]=[Hf.tc_date_1_hour_ago,Hf.tc_date_x_hours_ago],bg[Nm.Day]=[Hf.tc_date_1_day_ago,Hf.tc_date_x_days_ago],bg[Nm.Week]=[Hf.tc_date_1_week_ago,Hf.tc_date_x_weeks_ago],bg[Nm.Month]=[Hf.tc_date_1_month_ago,Hf.tc_date_x_months_ago],bg[Nm.Year]=[Hf.tc_date_1_year_ago,Hf.tc_date_x_years_ago],bg),Sg=function(n,c){var r=function(n){return[(e=""+(r=_g.distanceFromNow(n.createdAt),o=c,i=xg[r.interval],u=1===r.intervalUnits?i[0]:i[1],o.translate([u,r.intervalUnits])),t=_.fromText(e),mu({element:t})),{dom:{tag:"span",classes:[],innerHtml:n.modifiedAt===n.createdAt?"":c.translate(Hf.tc_date_comment_edited)}}];var e,t,r,o,i,u},e={updateWith:function(n,e,t){Js.set(n,r(e))}};return{dom:{tag:"div",classes:Om.classes.date},components:r(n),behaviours:Do([Js.config({})]),apis:e}},Eg={editCommentEvent:yi("tc-conversation-edit-comment"),deleteCommentEvent:yi("tc-conversation-delete-comment"),deleteConversationEvent:yi("tc-conversation-delete-all"),createCommentEvent:yi("tc-conversation-create")},kg=function(n){var e,t,r,o=_.fromHtml(n),i=ee(o),u=(t=void 0!==(e=o).dom().attributes?e.dom().attributes:[],G(t,function(n,e){var t;return"class"===e.name?n:Ce({},n,((t={})[e.name]=e.value,t))},{})),c=(r=o,Array.prototype.slice.call(r.dom().classList,0)),a=0===i.length?{}:{innerHtml:Wo(o)};return Ce({tag:de(o),classes:c,attributes:u},a)},Cg=[Sf.config({}),Bo("overlay-button-events",[go(Tr(),function(n,e){e.event().prevent()})])],Tg=function(n,e,t){t?(ou(e.element(),"display"),e.hasConfigured(em)&&em.focusIn(e)):Zi(e.element(),"display","none")},Dg="alloy.item-hover",Mg="alloy.item-focus",Ng=function(n){(Io(n.element()).isNone()||af.isFocused(n))&&(af.isFocused(n)||af.focus(n),no(n,Dg,{item:n}))},Ag=function(n){no(n,Mg,{item:n})},Fg=W(Dg),Bg=W(Mg),Hg=[lr("data"),lr("components"),lr("dom"),hr("hasSubmenu",!1),gr("toggling"),wu("itemBehaviours",[Kf,af,em,Of]),hr("ignoreFocus",!1),hr("domModification",{}),Au("builder",function(n){return{dom:n.dom,domModification:Ce({},n.domModification,{attributes:Ce({role:n.toggling.isSome()?"menuitemcheckbox":"menuitem"},n.domModification.attributes,{"aria-haspopup":n.hasSubmenu},n.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:Ou(n.itemBehaviours,[n.toggling.fold(Kf.revoke,function(n){return Kf.config(Ce({aria:{mode:"checked"}},n))}),af.config({ignore:n.ignoreFocus,stopMousedown:n.ignoreFocus,onFocus:function(n){Ag(n)}}),em.config({mode:"execution"}),Of.config({store:{mode:"memory",initialValue:n.data}}),Bo("item-type-events",[go(Wr(),eo),po(Tr()),go(Dr(),Ng),go(Lr(),af.focus)])]),components:n.components,eventOrder:n.eventOrder}}),hr("eventOrder",{})],Rg=[lr("dom"),lr("components"),Au("builder",function(n){return{dom:n.dom,components:n.components,events:mo([(e=Lr(),go(e,function(n,e){e.stop()}))])};var e})],Ig=W([rc({name:"widget",overrides:function(e){return{behaviours:Do([Of.config({store:{mode:"manual",getValue:function(n){return e.data},setValue:function(){}}})])}}})]),Pg=[lr("uid"),lr("data"),lr("components"),lr("dom"),hr("autofocus",!1),hr("ignoreFocus",!1),wu("widgetBehaviours",[Of,af,em]),hr("domModification",{}),gc(Ig()),Au("builder",function(i){var n=lc(0,i,Ig()),e=dc("item-widget",i,n.internals()),t=function(n){return(e=n,t=i,r="widget",o=t.partUids[r],e.getSystem().getByUid(o).toOption()).map(function(n){return em.focusIn(n),n});var e,t,r,o},r=function(n,e){return Nl(e.event().target())||i.autofocus&&e.setSource(n.element()),A.none()};return{dom:i.dom,components:e,domModification:i.domModification,events:mo([wo(function(n,e){t(n).each(function(n){e.stop()})}),go(Dr(),Ng),go(Lr(),function(n,e){i.autofocus?t(n):af.focus(n)})]),behaviours:Ou(i.widgetBehaviours,[Of.config({store:{mode:"memory",initialValue:i.data}}),af.config({ignore:i.ignoreFocus,onFocus:function(n){Ag(n)}}),em.config({mode:"special",focusIn:i.autofocus?function(n){t(n)}:Fo(),onLeft:r,onRight:r,onEscape:function(n,e){return af.isFocused(n)||i.autofocus?(i.autofocus&&e.setSource(n.element()),A.none()):(af.focus(n),A.some(!0))}})])}})],Vg=ar("type",{widget:Pg,item:Hg,separator:Rg}),jg=W([uc({factory:{sketch:function(n){var e=ur("menu.spec item",Vg,n);return e.builder(e)}},name:"items",unit:"item",defaults:function(n,e){return e.hasOwnProperty("uid")?e:Ce({},e,{uid:ki("item")})},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus,domModification:{classes:[n.markers.item]}}}})]),Lg=W([lr("value"),lr("items"),lr("dom"),lr("components"),hr("eventOrder",{}),hu("menuBehaviours",[bl,Of,tf,em]),br("movement",{mode:"menu",moveOnTab:!0},ar("mode",{grid:[Bu(),Au("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers.item,initSize:{numColumns:e.initSize.numColumns,numRows:e.initSize.numRows},focusManager:n.focusManager}})],matrix:[Au("config",function(n,e){return{mode:"matrix",selectors:{row:e.rowSelector,cell:"."+n.markers.item},focusManager:n.focusManager}}),lr("rowSelector")],menu:[hr("moveOnTab",!0),Au("config",function(n,e){return{mode:"menu",selector:"."+n.markers.item,moveOnTab:e.moveOnTab,focusManager:n.focusManager}})]})),dr("markers",Su()),hr("fakeFocus",!1),hr("focusManager",wl()),Tu("onHighlight")]),Ug=W("alloy.menu-focus"),Wg=Oc({name:"Menu",configFields:Lg(),partFields:jg(),factory:function(n,e,t,r){return{uid:n.uid,dom:n.dom,markers:n.markers,behaviours:yu(n.menuBehaviours,[bl.config({highlightClass:n.markers.selectedItem,itemClass:n.markers.item,onHighlight:n.onHighlight}),Of.config({store:{mode:"memory",initialValue:n.value}}),tf.config({find:A.some}),em.config(n.movement.config(n,n.movement))]),events:mo([go(Bg(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){bl.highlight(e,n),t.stop(),no(e,Ug(),{menu:e,item:n})})}),go(Fg(),function(n,e){var t=e.event().item();bl.highlight(n,t)})]),components:e,eventOrder:n.eventOrder,domModification:{attributes:{role:"menu"}}}}}),zg=function(t,r,o,n){return gt(o,n).bind(function(n){return gt(t,n).bind(function(n){var e=zg(t,r,o,n);return A.some([n].concat(e))})}).getOr([])},Gg=function(n,e){var t={};cn(n,function(n,e){L(n,function(n){t[n]=e})});var r=e,o=sn(e,function(n,e){return{k:n,v:e}}),i=an(o,function(n,e){return[e].concat(zg(t,r,o,e))});return an(t,function(n){return gt(i,n).getOr([n])})},qg=function(){var i=ce({}),u=ce({}),c=ce({}),a=ce(A.none()),s=ce({}),e=function(n){return gt(u.get(),n)};return{setMenuBuilt:function(n,e){var t;u.set(Ce({},u.get(),((t={})[n]={type:"prepared",menu:e},t)))},setContents:function(n,e,t,r){a.set(A.some(n)),i.set(t),u.set(e),s.set(r);var o=Gg(r,t);c.set(o)},expand:function(t){return gt(i.get(),t).map(function(n){var e=gt(c.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return gt(c.get(),n)},collapse:function(n){return gt(c.get(),n).bind(function(n){return 1<n.length?A.some(n.slice(1)):A.none()})},lookupMenu:e,otherMenus:function(n){var e=s.get();return en(on(e),n)},getPrimary:function(){return a.get().bind(function(n){return e(n).bind(function(n){return"prepared"===n.type?A.some(n.menu):A.none()})})},getMenus:function(){return u.get()},clear:function(){i.set({}),u.set({}),c.set({}),a.set(A.none())},isClear:function(){return a.get().isNone()}}},Yg=W("collapse-item"),Kg=wc({name:"TieredMenu",configFields:[Nu("onExecute"),Nu("onEscape"),Mu("onOpenMenu"),Mu("onOpenSubmenu"),Tu("onCollapseMenu"),hr("highlightImmediately",!0),mr("data",[lr("primary"),lr("menus"),lr("expansions")]),hr("fakeFocus",!1),Tu("onHighlight"),Tu("onHover"),ku(),lr("dom"),hr("navigateOnHover",!0),hr("stayInDom",!1),hu("tmenuBehaviours",[em,bl,tf,Js]),hr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)},highlightPrimary:function(n,e){n.highlightPrimary(e)}},factory:function(c,n){var a,e,i=ce(A.none()),u=function(r,o,n){return an(n,function(n,e){var t=function(){return Wg.sketch(Ce({dom:n.dom},n,{value:e,items:n.items,markers:c.markers,fakeFocus:c.fakeFocus,onHighlight:c.onHighlight,focusManager:c.fakeFocus?(o=function(n){return bl.getHighlighted(n).map(function(n){return n.element()})},{get:o,set:function(e,n){var t=o(e);e.getSystem().getByDom(n).fold(y,function(n){bl.highlight(e,n)});var r=o(e);yl(e,t,r)}}):wl()}));var o};return e===o?{type:"prepared",menu:r.getSystem().build(t())}:{type:"notbuilt",nbMenu:t}})},s=qg(),f=function(n){return Of.getValue(n).value},l=function(n){return an(c.data.menus,function(n,e){return $(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},d=function(e,n){bl.highlight(e,n),bl.getHighlighted(n).orThunk(function(){return bl.getFirst(n)}).each(function(n){to(e,n.element(),Lr())})},m=function(e,n){return Lo(j(n,function(n){return e.lookupMenu(n).bind(function(n){return"prepared"===n.type?A.some(n.menu):A.none()})}))},g=function(e,n,t){var r=m(n,n.otherMenus(t));L(r,function(n){Xi(n.element(),[c.markers.backgroundMenu]),c.stayInDom||Js.remove(e,n)})},v=function(n,r){var o,e=(o=n,i.get().getOrThunk(function(){var t={},n=qe(o.element(),"."+c.markers.item),e=U(n,function(n){return"true"===we(n,"aria-haspopup")});return L(e,function(n){o.getSystem().getByDom(n).each(function(n){var e=f(n);t[e]=n})}),i.set(A.some(t)),t}));cn(e,function(n,e){var t=P(r,e);be(n.element(),"aria-expanded",t)})},p=function(r,o,i){return A.from(i[0]).bind(function(n){return o.lookupMenu(n).bind(function(n){if("notbuilt"===n.type)return A.none();var e=n.menu,t=m(o,i.slice(1));return L(t,function(n){Ue(n.element(),c.markers.backgroundMenu)}),xe(e.element())||Js.append(r,pu(e)),Xi(e.element(),[c.markers.backgroundMenu]),d(r,e),g(r,o,i),A.some(e)})})};(e=a||(a={}))[e.HighlightSubmenu=0]="HighlightSubmenu",e[e.HighlightParent=1]="HighlightParent";var h=function(o,i,u){void 0===u&&(u=a.HighlightSubmenu);var n=f(i);return s.expand(n).bind(function(r){return v(o,r),A.from(r[0]).bind(function(t){return s.lookupMenu(t).bind(function(n){var e=function(n,e,t){if("notbuilt"!==t.type)return t.menu;var r=n.getSystem().build(t.nbMenu());return s.setMenuBuilt(e,r),r}(o,t,n);return xe(e.element())||Js.append(o,pu(e)),c.onOpenSubmenu(o,i,e),u===a.HighlightSubmenu?(bl.highlightFirst(e),p(o,s,r)):(bl.dehighlightAll(e),A.some(i))})})})},r=function(e,t){var n=f(t);return s.collapse(n).bind(function(n){return v(e,n),p(e,s,n).map(function(n){return c.onCollapseMenu(e,t,n),n})})},t=function(t){return function(e,n){return ii(n.getSource(),"."+c.markers.item).bind(function(n){return e.getSystem().getByDom(n).toOption().bind(function(n){return t(e,n).map(function(){return!0})})})}},o=mo([go(Ug(),function(e,n){var t=n.event().menu();bl.highlight(e,t);var r=f(n.event().item());s.refresh(r).each(function(n){return g(e,s,n)})}),wo(function(e,n){var t=n.event().target();e.getSystem().getByDom(t).each(function(n){0===f(n).indexOf("collapse-item")&&r(e,n),h(e,n,a.HighlightSubmenu).fold(function(){c.onExecute(e,n)},function(){})})}),ho(function(e,n){var t,r,o;(t=e,r=u(t,c.data.primary,c.data.menus),o=l(t),s.setContents(c.data.primary,r,c.data.expansions,o),s.getPrimary()).each(function(n){Js.append(e,pu(n)),c.onOpenMenu(e,n),c.highlightImmediately&&d(e,n)})})].concat(c.navigateOnHover?[go(Fg(),function(n,e){var t,r,o=e.event().item();t=n,r=f(o),s.refresh(r).bind(function(n){return v(t,n),p(t,s,n)}),h(n,o,a.HighlightParent),c.onHover(n,o)})]:[])),b={collapseMenu:function(e){bl.getHighlighted(e).each(function(n){bl.getHighlighted(n).each(function(n){r(e,n)})})},highlightPrimary:function(e){s.getPrimary().each(function(n){d(e,n)})}};return{uid:c.uid,dom:c.dom,markers:c.markers,behaviours:yu(c.tmenuBehaviours,[em.config({mode:"special",onRight:t(function(n,e){return Nl(e.element())?A.none():h(n,e,a.HighlightSubmenu)}),onLeft:t(function(n,e){return Nl(e.element())?A.none():r(n,e)}),onEscape:t(function(n,e){return r(n,e).orThunk(function(){return c.onEscape(n,e).map(function(){return n})})}),focusIn:function(e,n){s.getPrimary().each(function(n){to(e,n.element(),Lr())})}}),bl.config({highlightClass:c.markers.selectedMenu,itemClass:c.markers.menu}),tf.config({find:function(n){return bl.getHighlighted(n)}}),Js.config({})]),eventOrder:c.eventOrder,apis:b,events:o}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:vt(n,e),expansions:{}}},collapseItem:function(n){return{value:yi(Yg()),meta:{text:n}}}}}),Xg=function(e,n){return(t=n,so(t,function(n){if(!ge(n))return!1;var e=we(n,"id");return void 0!==e&&-1<e.indexOf("aria-owns")}).bind(function(n){var e=we(n,"id"),t=Jn(n);return oi(t,'[aria-owns="'+e+'"]')})).exists(function(n){return Qg(e,n)});var t},Qg=function(e,n){return t=n,o=W(!(r=function(n){return $n(n,e.element())})),so(t,r,o).isSome()||Xg(e,n);var t,r,o},$g=Object.freeze({getCoupled:function(n,e,t,r){return t.getOrCreate(n,e,r)}}),Jg=[dr("others",rr(Fe.value,sr()))],Zg=No({fields:Jg,name:"coupling",apis:$g,state:Object.freeze({init:function(n){var i={},e=W({});return Or({readState:e,getOrCreate:function(t,r,o){var n=on(r.others);if(n)return gt(i,o).getOrThunk(function(){var n=gt(r.others,o).getOrDie("No information found for coupled component: "+o)(t),e=t.getSystem().build(n);return i[o]=e});throw new Error("Cannot find coupled component: "+o+". Known coupled components: "+Vt(n,null,2))}})}})}),nv=function(n,e,t,r){var o=function(e,n,t,r){t.get().each(function(n){Tc(e)});var o=n.getAttachPoint(e);Sc(o,e);var i=e.getSystem().build(r);return Sc(e,i),t.set(i),i}(n,e,t,r);return e.onOpen(n,o),o},ev=function(e,t,r){r.get().each(function(n){Tc(e),Cc(e),t.onClose(e,n),r.clear()})},tv=function(n,e,t){return t.isOpen()},rv=function(n,e,t){var r,o,i,u,c=e.getAttachPoint(n);Zi(n.element(),"position",Ys.getMode(c)),r=n,o="visibility",i=e.cloakVisibilityAttr,u="hidden",ru(r.element(),o).fold(function(){_e(r.element(),i)},function(n){be(r.element(),i,n)}),Zi(r.element(),o,u)},ov=function(n,e,t){var r;r=n.element(),V(["top","left","right","bottom"],function(n){return ru(r,n).isSome()})||ou(n.element(),"position"),function(n,e,t){if(Oe(n.element(),t)){var r=we(n.element(),t);Zi(n.element(),e,r)}else ou(n.element(),e)}(n,"visibility",e.cloakVisibilityAttr)},iv=Object.freeze({cloak:rv,decloak:ov,open:nv,openWhileCloaked:function(n,e,t,r,o){rv(n,e,t),nv(n,e,t,r),o(),ov(n,e,t)},close:ev,isOpen:tv,isPartOf:function(e,t,n,r){return tv(0,0,n)&&n.get().exists(function(n){return t.isPartOf(e,n,r)})},getState:function(n,e,t){return t.get()}}),uv=Object.freeze({events:function(t,r){return mo([go(Gr(),function(n,e){ev(n,t,r)})])}}),cv=[Tu("onOpen"),Tu("onClose"),lr("isPartOf"),lr("getAttachPoint"),hr("cloakVisibilityAttr","data-precloak-visibility")],av=No({fields:cv,name:"sandboxing",active:uv,apis:iv,state:Object.freeze({init:function(){var e=ce(A.none()),n=W("not-implemented");return Or({readState:n,isOpen:function(){return e.get().isSome()},clear:function(){e.set(A.none())},set:function(n){e.set(A.some(n))},get:function(n){return e.get()}})}})}),sv=W("sink"),fv=W(ic({name:sv(),overrides:W({dom:{tag:"div"},behaviours:Do([Ys.config({useFixed:!0})]),events:mo([po(Mr()),po(Tr()),po(Fr())])})})),lv=Object.freeze({events:function(c){return mo([go(Vr(),function(o,i){var n,e,u=c.channels,t=on(u),r=(n=t,(e=i).universal()?n:U(n,function(n){return P(e.channels(),n)}));L(r,function(n){var e=u[n],t=e.schema,r=ur("channel["+n+"] data\nReceiver: "+Yo(o.element()),t,i.data());e.onReceive(o,r)})})])}}),dv=[dr("channels",rr(Fe.value,Yt([Mu("onReceive"),hr("schema",sr())])))],mv=No({fields:dv,name:"receiving",active:lv}),gv=Yt([hr("isExtraPart",W(!1)),vr("fireEventInstead",[hr("event",Xr())])]),vv=function(n){var t=ur("Dismissal",gv,n);return{channels:vt(O(),{schema:Yt([lr("target")]),onReceive:function(e,n){av.isOpen(e)&&(av.isPartOf(e,n.target)||t.isExtraPart(e,n.target)||t.fireEventInstead.fold(function(){return av.close(e)},function(n){return Zr(e,n.event)}))}})}};(wg=yg||(yg={}))[wg.HighlightFirst=0]="HighlightFirst",wg[wg.HighlightNone=1]="HighlightNone";var pv,hv,bv=function(n,e){var t=n.getHotspot(e).getOr(e);return n.layouts.fold(function(){return{anchor:"hotspot",hotspot:t}},function(n){return{anchor:"hotspot",hotspot:t,layouts:n}})},yv=function(n,e,t,r,o,i,u){var c,a,s,f,l,d,m,g,v,p,h=bv(n,t);return(a=h,f=r,l=o,d=u,m=e,g=s=t,v=(0,(c=n).fetch)(g).map(m),p=xv(s,c),v.map(function(n){return n.bind(function(n){return A.from(Kg.sketch(Ce({},l.menu(),{uid:ki(""),data:n,highlightImmediately:d===yg.HighlightFirst,onOpenMenu:function(n,e){var t=p().getOrDie();Ys.position(t,a,e),av.decloak(f)},onOpenSubmenu:function(n,e,t){var r=p().getOrDie();Ys.position(r,{anchor:"submenu",item:e},t),av.decloak(f)},onEscape:function(){return af.focus(s),av.close(f),A.some(!0)}})))})})).map(function(n){return n.fold(function(){av.isOpen(r)&&av.close(r)},function(n){av.cloak(r),av.open(r,n),i(r)}),r})},wv=function(n,e,t,r,o,i,u){return av.close(r),le.pure(r)},Ov=function(n,e,t,r,o,i){var u=Zg.getCoupled(t,"sandbox");return(av.isOpen(u)?wv:yv)(n,e,t,u,r,o,i)},_v=function(n,e,t){var r,o,i,u=tf.getCurrent(e).getOr(e),c=(r=n.element(),Xc.get(r));t?Zi(u.element(),"min-width",c+"px"):(o=u.element(),i=c,Xc.set(o,i))},xv=function(e,n){return e.getSystem().getByUid(n.uid+"-"+sv()).map(function(n){return function(){return Fe.value(n)}}).getOrThunk(function(){return n.lazySink.fold(function(){return function(){return Fe.error(new Error("No internal sink is specified, nor could an external sink be found"))}},function(n){return function(){return n(e)}})})},Sv=function(r,o,i){var e,n,t,u=(e=yi("aria-owns"),{id:W(e),link:function(n){be(n,"aria-owns",e)},unlink:function(n){_e(n,"aria-owns")}}),c=xv(o,r);return{dom:{tag:"div",classes:r.sandboxClasses,attributes:{id:u.id()}},behaviours:Ou(r.sandboxBehaviours,[Of.config({store:{mode:"memory",initialValue:o}}),av.config({onOpen:function(n,e){var t=bv(r,o);u.link(o.element()),r.matchWidth&&_v(t.hotspot,e,r.useMinWidth),r.onOpen(t,n,e),void 0!==i&&void 0!==i.onOpen&&i.onOpen(n,e)},onClose:function(n,e){u.unlink(o.element()),void 0!==i&&void 0!==i.onClose&&i.onClose(n,e)},isPartOf:function(n,e,t){return Qg(e,t)||Qg(o,t)},getAttachPoint:function(){return c().getOrDie()}}),tf.config({find:function(n){return av.getState(n).bind(function(n){return tf.getCurrent(n)})}}),(n={isExtraPart:W(!1)},t=vv(n),mv.config(t))])}},Ev=W([lr("dom"),lr("fetch"),Tu("onOpen"),Du("onExecute"),hr("getHotspot",A.some),hr("layouts",A.none()),hu("dropdownBehaviours",[Kf,Zg,em,af]),lr("toggleClass"),hr("eventOrder",{}),gr("lazySink"),hr("matchWidth",!1),hr("useMinWidth",!1),gr("role")].concat([hr("sandboxClasses",[]),wu("sandboxBehaviours",[tf,mv,av,Of])])),kv=W([oc({schema:[ku()],name:"menu",defaults:function(n){return{onExecute:n.onExecute}}}),fv()]),Cv=Oc({name:"Dropdown",configFields:Ev(),partFields:kv(),factory:function(e,n,t,r){var o,i,u=function(n){av.getState(n).each(function(n){Kg.highlightPrimary(n)})},c={expand:function(n){Kf.isOn(n)||Ov(e,function(n){return n},n,r,y,yg.HighlightNone).get(y)},open:function(n){Kf.isOn(n)||Ov(e,function(n){return n},n,r,y,yg.HighlightFirst).get(y)},isOpen:Kf.isOn,close:function(n){Kf.isOn(n)&&Ov(e,function(n){return n},n,r,y,yg.HighlightFirst).get(y)}},a=function(n,e){return eo(n),A.some(!0)};return{uid:e.uid,dom:e.dom,components:n,behaviours:yu(e.dropdownBehaviours,[Kf.config({toggleClass:e.toggleClass,aria:{mode:"expanded"}}),Zg.config({others:{sandbox:function(n){return Sv(e,n,{onOpen:function(){Kf.on(n)},onClose:function(){Kf.off(n)}})}}}),em.config({mode:"special",onSpace:a,onEnter:a,onDown:function(n,e){if(Cv.isOpen(n)){var t=Zg.getCoupled(n,"sandbox");u(t)}else Cv.open(n);return A.some(!0)},onEscape:function(n,e){return Cv.isOpen(n)?(Cv.close(n),A.some(!0)):A.none()}}),af.config({})]),events:Xf(A.some(function(n){Ov(e,function(n){return n},n,r,u,yg.HighlightFirst).get(y)})),eventOrder:Ce({},e.eventOrder,(o={},o[jr()]=["disabling","toggling","alloy.base.behaviour"],o)),apis:c,domModification:{attributes:Ce({"aria-haspopup":"true"},e.role.fold(function(){return{}},function(n){return{role:n}}),"button"===e.dom.tag?{type:(i="type",gt(e.dom,"attributes").bind(function(n){return gt(n,i)})).getOr("button")}:{})}}},apis:{open:function(n,e){return n.open(e)},expand:function(n,e){return n.expand(e)},close:function(n,e){return n.close(e)},isOpen:function(n,e){return n.isOpen(e)}}}),Tv=yi("tc-kebab-action"),Dv="basecamp",Mv="deleting",Nv={textKey:Hf.tc_kebab_edit,eventName:ng},Av={textKey:Hf.tc_kebab_delete,eventName:$m},Fv={textKey:Hf.tc_kebab_deleteconversation,eventName:Jm},Bv=function(n,c,e,t,r){var o,i;void 0===e&&(e='<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 24C5.373 24 0 18.627 0 12S5.373 0 12 0s12 5.373 12 12-5.373 12-12 12zm-8.693-5.259A10.981 10.981 0 0 0 12 23c3.535 0 6.68-1.668 8.693-4.259C19.432 16.251 14.591 15 12 15c-2.59 0-7.432 1.25-8.693 3.741zm8.7-5.741C14.224 13 16 10.99 16 8.5S14.224 4 12.007 4C9.79 4 8 6.01 8 8.5S9.79 13 12.007 13z" fill-rule="nonzero"></path></svg>');var u,a,s,f,l,d,m,g,v,p,h,b,y,w,O,_,x=ce(n),S=Q([t.deleteConversation?[Fv]:[],t.editComment?[Nv]:[],t.deleteComment?[Av]:[]]),E=Mc(Sg(n,r.universe)),k={updateWith:function(n,e,t){var r,o,i,u;x.set(e),T.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),D.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),r=n,o=t.numComments,i=e.isDeleting===El.QueryingDelete,u=c,M.getOpt(r).each(function(n){return Tg(0,n,i)}),N.getOpt(r).each(function(n){var e=u?[Hf.tc_delete_prompts_conversation,1===o?Hf.tc_delete_prompts_conversation_detail_sing:{pattern:Hf.tc_delete_prompts_conversation_detail_pl,targets:[o]}]:[Hf.tc_delete_prompts_comment];n.getApis().setText(n,e),Tg(0,n,i)}),e.isDeleting===El.PostDelete&&Ff.getCurrentRoute(n).filter(function(n){return n.destination===Mv}).fold(function(){Ff.progressTo(n,Mv)},function(n){}),E.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})})}},C={dom:{tag:"div",classes:Om.classes.cardHead},components:Q([[{dom:{tag:"div",classes:Om.classes.cardHeadMeta},components:[(f=x.get().author,l=e,d={dom:{tag:"div",classes:Om.classes.avatar,innerHtml:l}},m={dom:{tag:"div",classes:Om.classes.username,innerHtml:f}},{dom:{tag:"div",classes:Om.classes.user},components:[d,{dom:{tag:"div"},components:[m,E.asSpec()]}]})]}],0<S.length?[(u=S,a=r,s=j(u,function(e){return{type:"item",data:{value:e.eventName},dom:{tag:"div",classes:Om.classes.kebabItem},components:[{dom:{tag:"span",classes:Om.classes.kebabItemLabel,innerHtml:a.universe.translate(e.textKey)}}],itemBehaviours:Do([Bo("item-events",[wo(function(n){no(n,Tv,{eventName:e.eventName}),Zr(n,Gr())})])])}}),Cv.sketch({dom:{tag:"button",attributes:{type:"button"},classes:Om.classes.kebab},components:[{dom:{tag:"div",classes:Om.classes.kebabIcon,innerHtml:'<svg width="24" height="24" data-name="icon-image-options"><g id="icon-image-options" stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z" id="Shape" fill-rule="nonzero"></path></g></svg>'}}],lazySink:function(n){return a.getSink(n).fold(function(){return Fe.error("Could not find sink for kebab")},Fe.value)},dropdownBehaviours:Do([Sf.config({tabAttr:lg})]),sandboxBehaviours:Do([Bo("kebab-sandbox-events",[go(Tv,function(n,e){var t=Of.getValue(n);Zr(t,e.event().eventName())})])]),parts:{menu:{dom:{tag:"div"},markers:Om.markers.kebab}},toggleClass:Om.states.kebabOpen,layouts:A.some({onLtr:function(){return[Ua]},onRtl:function(){return[La]}}),fetch:function(n){var e=yi("kebab-id");return le.pure(A.some(Kg.singleData(e,{value:yi(e),dom:{tag:"div",classes:Om.classes.kebabMenu},components:[{dom:{tag:"div",classes:Om.classes.kebabMenuGroup},components:[Wg.parts().items({})]}],items:s})))}}))]:[]])},T=Mc((g={uid:n.uid,mode:n.mode},v=ce(g),p={updateWith:function(n,e,t){switch(v.set(e),e.mode){case xl.None:Zi(n.element(),"display","none");break;case xl.Collapsed:ou(n.element(),"display"),re(n.element()).each(function(n){return zo(n,Hf.tc_comment_buttons_showmore)});break;case xl.Expanded:ou(n.element(),"display"),re(n.element()).each(function(n){return zo(n,Hf.tc_comment_buttons_showless)});break;case xl.ExpandOrNone:case xl.CollapsedOrNone:break;case xl.Edit:Zi(n.element(),"display","none")}}},{dom:{tag:"div",classes:Om.classes.showMoreLessContainer,styles:{display:"none"}},components:[tm.sketch({dom:{tag:"p",classes:Om.classes.showMoreLess,innerHtml:Hf.tc_comment_buttons_showmore},action:function(n){Vm(v.get().uid,function(n){return{mode:v.get().mode===xl.Collapsed?xl.Expanded:xl.Collapsed}})(n)},buttonBehaviours:Do([Sf.config({tabAttr:lg})])})],apis:p})),D=Mc(vg(x.get(),r.universe)),M=Mc((r.universe,{dom:{tag:"div",classes:Om.classes.cardDelete,styles:{display:"none"}}})),N=Mc((h=function(){return x.get().uid},b=r.universe,y=function(n){Zr(n,Qm),Vm(h(),function(n){return{isDeleting:El.BeforeDelete}})(n)},w=function(n,e,t){var r;return tm.sketch({dom:{tag:"button",classes:n?Om.classes.button:Om.classes.secondaryButton,innerHtml:e},eventOrder:(r={},r[Tr()]=["alloy.base.behaviour","focusing","overlay-button-events"],r),action:t,buttonBehaviours:Do(Cg)})},O={setText:function(n,e){Js.set(n,j(e,function(n){var e="string"==typeof n?b.translate(n):b.translate([n.pattern].concat(n.targets));return{dom:{tag:"div"},components:[{dom:kg("<p>"+e+"</p>")}]}}).concat([_.asSpec()]))}},_=Mc({dom:{tag:"div",classes:Om.classes.cardDeleteButtons},components:[w(!0,b.translate(Hf.tc_delete_buttons_cancel),y),w(!1,b.translate(Hf.tc_delete_buttons_proceed),function(n){Zr(n,Zm)})]}),{dom:{tag:"div",styles:{display:"none"},classes:Om.classes.cardDeleteLabel},components:[],apis:O,behaviours:Do([Js.config({}),Bo("card-delete-events",[go(Ir(),function(n){Io(n.element()).fold(function(){Vm(h(),function(n){return{isDeleting:El.BeforeDelete}})(n)},function(){})})]),em.config({mode:"cyclic",onEscape:function(n){return y(n),A.some(!0)}})])}));return{dom:{tag:"div",classes:Om.classes.card,styles:{position:"relative"}},components:[C,D.asSpec(),M.asSpec(),N.asSpec(),T.asSpec()],behaviours:Do([af.config({}),Sf.config({}),sg({escapeEvent:Qm}),Ff.config({initialState:Dv,onTransition:function(n,e){var t;t=x.get().uid,no(n,Dm,{uid:t})},routes:(o={},o[Dv]=(i={},i[Mv]={transition:{property:"opacity",transitionClass:Om.states.disappearing}},i),o)}),Of.config({store:{mode:"memory",initialValue:x.get().uid}}),Bo("comment-events",[go(tg,function(n){return Vm(x.get().uid,function(){return{mode:x.get().mode===xl.Collapsed?xl.Expanded:xl.Collapsed}})(n)}),go(Qm,af.focus),go($m,function(n,e){Vm(x.get().uid,function(n){return{isDeleting:El.QueryingDelete}})(n)}),go(Jm,function(n,e){Vm(x.get().uid,function(n){return{isDeleting:El.QueryingDelete}})(n)}),go(ng,function(n){return Vm(x.get().uid,function(n){return{mode:xl.Edit}})(n)}),go(eg,function(t){D.getOpt(t).each(function(n){var e=Of.getValue(n);no(t,Eg.editCommentEvent,{uid:x.get().uid,content:e})})}),go(Zm,function(n,e){no(n,c?Eg.deleteConversationEvent:Eg.deleteCommentEvent,{uid:x.get().uid})})])]),apis:k}},Hv=function(n,r){return j(n,function(n,e){var t=0===e;return Bv(n,t,void 0,{editComment:!0,deleteComment:0<e,deleteConversation:t},r)})},Rv=function(n,o){var e={setComments:function(n,e){tf.getCurrent(n).each(function(n){Js.set(n,Hv(e,o))}),jm(n)},updateWith:function(e,r,n){tf.getCurrent(e).each(function(n){var t=Js.contents(n);tn(r).exists(function(n){return n.isDeleting===El.QueryingDelete})?Ue(n.element(),Om.states.deletingConversation):ze(n.element(),Om.states.deletingConversation),t.length!==r.length?Js.set(n,Hv(r,o)):L(t,function(n,e){t[e].getApis().updateWith(t[e],r[e],{numComments:r.length})}),jm(e)})},scrollToEnd:function(i){tf.getCurrent(i).each(function(n){var e,t=Js.contents(n);(e=t,0===e.length?A.none():A.some(e[e.length-1])).each(function(n){var e,t,r,o;e=n.element(),t=i.element(),r=t.dom().getBoundingClientRect(),(o=e.dom().getBoundingClientRect()).top<r.top?Vc(e,!0):o.bottom>r.bottom&&Vc(e,!1)})})}};return{dom:{tag:"div",classes:Om.classes.outerScroll},components:[{dom:{tag:"div",classes:Om.classes.commentList},components:Hv(n,o),behaviours:Do([fg({selector:Om.selectors.card}),Js.config({})])}],behaviours:Do([tf.config({find:function(e){return re(e.element()).bind(function(n){return e.getSystem().getByDom(n).toOption()})}})]),apis:e}};(hv=pv||(pv={}))[hv.Start=0]="Start",hv[hv.Reply=1]="Reply";var Iv=yi("tc-clear-input"),Pv=yi("tc-submit-input"),Vv=function(n){return e=Pv,t=n,ig.sketch({tag:"textarea",inputClasses:Om.classes.replyTextarea,inputAttributes:Ce({},dg,{placeholder:t.translate(Hf.tc_reply_placeholders)}),inputStyles:mg,inputBehaviours:Do([ag({enterEvent:e}),Sf.config({}),Bo("reply-events",[go(Ar(),gg)])])});var e,t},jv=function(t,n){var r=Mc(Vv(n)),e={focusEditor:function(n){r.getOpt(n).each(af.focus)},updateWith:function(n,e,t){V(e,function(n){return n.mode===xl.Edit})?Zi(n.element(),"display","none"):ou(n.element(),"display")}};return{dom:{tag:"div",classes:Om.classes.replySection},behaviours:Do([Bo("reply-events",[go(Iv,function(n){r.getOpt(n).each(function(n){Of.setValue(n,"")})}),go(Pv,function(e){r.getOpt(e).map(Of.getValue).each(function(n){0<n.length&&no(e,Eg.createCommentEvent,{content:n,mode:t})})})])]),components:[r.asSpec(),Em.secondary({text:n.translate(Hf.tc_reply_buttons_clear),eventName:A.some(Iv)}),Em.primary({text:n.translate(Hf.tc_reply_buttons_save),eventName:A.some(Pv)})],apis:e}},Lv=function(){var r=ce(Im()),n=function(n){r.set(n(r.get()))};return{clearAll:function(){r.set(Im())},recalibrate:function(r){n(function(n){return t=n,e=r.comments,{targetUid:t.targetUid,conversation:j(e,function(n,e){return{uid:n.uid,props:Ce({},n,{isDeleting:El.BeforeDelete,mode:t.targetUid.is(n.uid)?xl.ExpandOrNone:xl.CollapsedOrNone})}}),queue:[]};var t,e})},enqueuePatch:function(e,t){n(function(n){return Hm(n,[{uid:e,patch:t}])})},enqueuePatches:function(e){n(function(n){return Hm(n,e)})},setTargetUid:function(e){n(function(n){return Bm(n,A.some(e))})},clearTargetUid:function(){n(function(n){return Bm(n,A.none())})},processQueue:function(){return Rm(r.get()).map(function(n){var e=n.world,t=n.props;return r.set(e),t})},purge:function(t){n(function(n){var e=U(n.conversation,function(n){return n.uid!==t});return Ce({},n,{conversation:e})})},getProps:function(){return Fm(r.get())},adjust:function(e){n(function(n){return Hm(n,j(e,function(n){return{uid:n.uid,patch:"to-delete"===n.type?{isDeleting:El.PostDelete}:{}}}))})}}},Uv=function(n){return{type:"redraw-sidebar",view:n}},Wv=function(n,e){if(n.conversation.uid!==e.conversation.uid)return Uv(e);var t,r,o=j(n.conversation.comments,function(n){return n.uid}),i=j(e.conversation.comments,function(n){return n.uid});return r=i,(t=o).length===r.length&&J(t,function(n,e){return n===r[e]})?{type:"refresh-comments",comments:j(e.conversation.comments,function(n,e){return{uid:n.uid,patch:Ce({},n)}})}:0!==en(i,o).length?Uv(e):{type:"remove-comments",adjustments:j(o,function(n){return{type:P(i,n)?"to-remain":"to-delete",uid:n}})}},zv=yi("tc-escapeInSidebar"),Gv=function(n,t,r,e){var o=function(e){l.get().each(function(n){"comments"===n.type&&e(n.conversation.uid)})},u=Lv(),c=function(){u.processQueue().each(function(e){h(e),m.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})})},i=function(e){o(function(n){return e(n).get(function(n){n.fold(function(n){return n()},function(n){return n()})})})},a=function(n){n.get(function(n){n.fold(function(n){n()},function(n){u.setTargetUid(n.targetUid),n.fn()})})},s=vu({dom:{tag:"div",classes:n,styles:{position:"relative"}},behaviours:Do([Js.config({}),cg({onEscape:function(n){return Zr(n,zv),A.some(!0)}}),Bo("sidebar-events",[go(Tm,function(n,e){u.enqueuePatch(e.event().uid(),e.event().patch())}),go(Dm,function(n,e){u.purge(e.event().uid()),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().updateWith(n,e,{})})}),go(Mm,function(n){c()}),go(zv,function(n,e){t.onEscape()}),go(Eg.deleteConversationEvent,function(n,e){i(function(n){return r.deleteConversation(n,e.event().uid())})}),go(Eg.deleteCommentEvent,function(n,e){i(function(n){return r.deleteComment(n,e.event().uid())})}),go(Eg.editCommentEvent,function(n,e){o(function(n){a(r.editComment(n,e.event().uid(),e.event().content()))})}),go(Eg.createCommentEvent,function(n,e){e.event().mode()===pv.Reply?o(function(n){a(r.reply(n,e.event().content()))}):a(r.createConversation(e.event().content()))})])])}),f=Dc(s),l=ce(A.none()),d=function(n){Js.set(s,[g.asSpec()].concat(n))},m=Mc(Rv([],{getSink:function(n){return g.getOpt(n)},universe:e})),g=Mc({dom:{tag:"div",styles:{"z-index":"100"}},behaviours:Do([Ys.config({})])}),v=Mc(jv(pv.Start,e)),p=Mc(jv(pv.Reply,e)),h=function(e){p.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})},b=function(n){"splash"===n.view.type?(u.clearAll(),d([v.asSpec()])):"comments"===n.view.type&&(u.recalibrate(n.view.conversation),d([m.asSpec(),p.asSpec()]),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().setComments(n,e),n.getApis().scrollToEnd(n)}))};return{system:f,root:s,element:f.element,update:function(i){m.getOpt(s).bind(function(e){return l.get().map(function(n){return{convUi:e,pview:n}})}).fold(function(){return b(i)},function(n){n.convUi;var e,t,r=n.pview,o=(e=r,t=i.view,e.type!==t.type?Uv(t):"splash"===t.type?{type:"no-change"}:Wv(e,t));switch(o.type){case"add-comment":b(i);break;case"no-change":break;case"redraw-sidebar":b(i);break;case"remove-comments":u.adjust(o.adjustments),c();break;case"refresh-comments":u.enqueuePatches(o.comments),c()}}),l.set(A.some(i.view)),Zs(s.element())&&i.grabFocus()&&p.getOpt(s).orThunk(function(){return v.getOpt(s)}).each(function(n){n.getApis().focusEditor(n)})},hasFocus:function(){return Io(s.element()).isSome()},getSink:g.getOpt}},qv="tc-delete-conversation-at-cursor",Yv=function(n,e){n.execCommand(qv,null,{conversationUid:e})},Kv=function(n,e,t,r){return n.fold(function(n){return Fe.error({message:e,error:n,refresh:r})},function(n){return t(n).fold(function(n){return Fe.error({message:n.permError,error:n.reason,refresh:r})},Fe.value)})},Xv=function(n){return ln(n,"reason")?n.reason:""},Qv=function(o,r,i){var u=function(n){return function(){i().showError(n.message,n.error),n.refresh&&n.refresh()}};return{createConversation:function(n){return Ie.wrap(o.create({content:n,createdAt:_g.nowISO8601()}).map(function(n){var e=Fe.value,t=y;return Kv(n,Hf.tc_create_problem,e,t).fold(function(n){return Fe.error(u(n))},function(n){return Fe.value({targetUid:n.conversationUid,fn:function(){r.annotator.annotate(Ke(),{uid:n.conversationUid}),i().refreshSidebar(A.some(n.conversationUid),3)}})})}))},reply:function(r,n){return Ie.wrap(o.reply({conversationUid:r,content:n,createdAt:_g.nowISO8601()}).map(function(n){var e=Fe.value,t=y;return Kv(n,Hf.tc_reply_problem,e,t).fold(function(n){return Fe.error(u(n))},function(n){return Fe.value({targetUid:n.commentUid,fn:function(){i().refreshSidebar(A.some(r),3)}})})}))},editComment:function(t,r,n){return Ie.wrap(o.editComment({conversationUid:t,commentUid:r,content:n,modifiedAt:_g.nowISO8601()}).map(function(n){var e=y;return Kv(n,Hf.tc_edit_problem_comment,function(n){return n.canEdit?Fe.value(n):Fe.error({permError:Hf.tc_edit_unauthorised_comment,reason:Xv(n)})},e).fold(function(n){return Fe.error(u(n))},function(n){return Fe.value({targetUid:r,fn:function(){i().refreshSidebar(A.some(t),4)}})})}))},deleteComment:function(e,n){return Ie.wrap(o.deleteComment({conversationUid:e,commentUid:n}).map(function(n){return Kv(n,Hf.tc_delete_problem_comment,function(n){return n.canDelete?Fe.value(n):Fe.error({permError:Hf.tc_delete_unauthorised_comment,reason:Xv(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Fe.error(u(n))},function(n){return Fe.value(function(){i().refreshSidebar(A.some(e),4)})})}))},deleteConversation:function(e){return Ie.wrap(o.deleteConversation({conversationUid:e}).map(function(n){return Kv(n,Hf.tc_delete_problem_conversation,function(n){return n.canDelete?Fe.value(n):Fe.error({permError:Hf.tc_delete_unauthorised_conversation,reason:Xv(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Fe.error(u(n))},function(n){return Fe.value(function(){Yv(r,e),i().refreshSidebar(A.none(),2)})})}))}}};return ke(function(n,e,t,r,o,i){var u,c,a,s,f,l,d=Qv(t,e,function(){return v}),m=n===w.Modern?(s=e,f=d,l=i,{createSidebar:function(){return Gv(Om.classes.roots.modern,{onEscape:function(){return s.focus()}},f,l)},createController:Xe}):(u=e,c=d,a=i,{createSidebar:function(){return Gv(Om.classes.roots.silver,{onEscape:function(){return u.focus()}},c,a)},createController:Xe}),g=m.createSidebar(),v=m.createController(t,r,e,g),p=function(n){g.system.broadcastOn([O()],{target:_.fromDom(n.target)})},h=C(_.fromDom(b.document),"mousedown",function(n){g.system.broadcastOn([O()],{target:n.target()})});e.on("mousedown",p),e.on("remove",function(){e.off("mousedown",p),h.unbind()}),o({controller:v,attachTo:function(n){ue(n,g.element())}})}),function(){}}(window)();